<h1>docs</h1>
<p>好的，我们继续来“翻译” <code>docs</code> 目录下的这两个重要文件和一个文件夹。我会按照你的要求，用最通俗的<strong>比喻</strong>和<strong>任务清单（Todo List）</strong>的方式来拆解它们。</p>
<hr />
<h2>📄 1. api-backwards-compatibility-check.md</h2>
<p><strong>【一句话总结】</strong>：这是 Megatron Core 项目的<strong>“代码交规手册”</strong>，目的是<strong>防止你改动代码后，把别人的车（已有代码）给撞坏了</strong>。</p>
<h3>🛠️ 开发者通关任务清单</h3>
<h4>第一阶段：理解规则（这是个啥？）</h4>
<p><strong>Task 1：理解“什么是违规驾驶”（Breaking Change）</strong>
想象你提供了一个自动贩卖机接口 <code>buy_coke(coin)</code>。
*   ❌ <strong>严重违规</strong>：你突然把它改成了 <code>buy_coke(coin, id_card)</code>（身份证必填）。
    *   <em>后果</em>：老用户还在用 <code>buy_coke(coin)</code>，结果机器报错“缺身份证”，系统崩溃。这叫“破坏向后兼容性”。
*   ✅ <strong>合规操作</strong>：你把它改成 <code>buy_coke(coin, id_card=None)</code>（身份证选填）。
    *   <em>后果</em>：老用户不传身份证也能买，新用户可以传身份证。这就叫“兼容”。</p>
<p><strong>Task 2：认识“交警机器人”</strong>
文档里提到的 <code>check_api_backwards_compatibility.py</code> 就是一个自动巡逻的交警。
*   每次你提交代码，它都会把你写的代码和<strong>上一个稳定版本</strong>做对比。
*   一旦发现你搞了“严重违规”，它就直接亮红灯（CI 报错），不让你合并代码。</p>
<h4>第二阶段：日常开发（我该怎么做？）</h4>
<p><strong>Task 3：写代码时的自查表</strong>
当你修改 <code>megatron/core</code> 里的公共函数时，问自己：
*   [ ] 我是不是删掉了一个参数？（❌ 达咩）
*   [ ] 我是不是加了一个<strong>没有默认值</strong>的新参数？（❌ 达咩）
*   [ ] 我是不是给参数重新排了个序？（❌ 达咩）
*   [ ] 我是不是把整个函数删了？（❌ 达咩）</p>
<h4>第三阶段：解决问题（被交警拦下咋办？）</h4>
<p>如果机器人报错了，你有四种选择：</p>
<ol>
<li><strong>认怂改回</strong>：确实是不小心改坏了，赶紧给新参数加上默认值（如 <code>new_arg=None</code>）。</li>
<li><strong>走后门（内部专用）</strong>：<ul>
<li>如果这个函数只是你自己内部用的，不想让用户用。</li>
<li><strong>操作</strong>：贴个条子 <code>@internal_api</code>。机器人看到这个条子就会放行。</li>
</ul>
</li>
<li><strong>申请试驾（实验功能）</strong>：<ul>
<li>如果这是个还在测试的新功能，以后可能会变。</li>
<li><strong>操作</strong>：贴个条子 <code>@experimental_api</code>。机器人也会放行。</li>
</ul>
</li>
<li><strong>拆迁办（废弃流程）</strong>：<ul>
<li>如果旧函数实在太烂，必须得改。</li>
<li><strong>操作</strong>：不能直接拆！要贴“拆迁公告” <code>@deprecated</code>。告诉用户：“这个函数将在下个版本拆除，请改用新函数”。</li>
</ul>
</li>
</ol>
<hr />
<h2>📄 2. llama_mistral.md</h2>
<p><strong>【一句话总结】</strong>：这是<strong>“进口车改装指南”</strong>。教你怎么把市面上开源的 Llama/Mistral 模型（进口零件），改装成 Megatron 能开的格式（本地组装）。</p>
<h3>📋 改装任务清单 (通用流程)</h3>
<p>无论你玩的是 Llama-2, Llama-3 还是 Mistral，流程都是这四步：</p>
<ol>
<li><strong>[进货]</strong>：去 HuggingFace 下载原版模型权重（Checkpoint）。</li>
<li><strong>[改装]</strong>：这是最关键的一步！用脚本把“HF 格式”转成“Megatron 格式”。</li>
<li><strong>[调试]</strong>：写好启动脚本，设置好参数（比如要把模型切成几份 TP）。</li>
<li><strong>[上路]</strong>：启动 Megatron 进行训练或推理。</li>
</ol>
<h3>📖 车型详解</h3>
<h4>🚗 车型 A：Llama-2</h4>
<ul>
<li><strong>改装难点</strong>：如果你下载的是 Meta 官网格式，得先转成 HuggingFace 格式，再转成 Megatron 格式（要把大象装冰箱，总共分三步）。</li>
<li><strong>切割建议 (TP)</strong>：<ul>
<li>7B 的小车 -&gt; 不用切 (TP=1)。</li>
<li>70B 的大卡车 -&gt; 切成 8 份 (TP=8)。</li>
</ul>
</li>
</ul>
<h4>🏎️ 车型 B：Llama-3.x (最新款)</h4>
<ul>
<li><strong>注意</strong>：只支持改装 HuggingFace 版的零件。</li>
<li><strong>新特性</strong>：<ul>
<li>Llama-3.1 支持超长车身（128k 上下文），启动时要开启 <code>--use-rope-scaling</code>。</li>
<li>一定要加上 <code>GQA</code> 和 <code>SwiGLU</code> 这些新式发动机参数。</li>
</ul>
</li>
</ul>
<h4>🚙 车型 C：Mistral-7b</h4>
<ul>
<li><strong>说明</strong>：这车跟 Llama 长得很像，改装流程基本一样。</li>
<li><strong>注意</strong>：目前支持 v0.3 版本，词表（Vocabulary）比较大。</li>
</ul>
<h4>⚠️ 两个技术备注</h4>
<ol>
<li><strong>仪表盘读数微差</strong>：改装后的车，跑出来的数值可能跟原版有小数点后几位的差异。<strong>这是正常的</strong>，因为 Megatron 为了跑得快，做了一些计算优化（如 GEMM 合并）。</li>
<li><strong>新旧底盘</strong>：文档推荐使用 <code>--saver core</code>（新式底盘），不要用 <code>--saver legacy</code>（老式底盘），除非你有历史包袱。</li>
</ol>
<hr />
<h2>📁 3. source/ 目录</h2>
<p><strong>【一句话总结】</strong>：这是项目的<strong>“出版社编辑部”</strong>。</p>
<p>针对你的三个问题，回答如下：</p>
<h3>1. 这个文件夹主要负责什么功能？</h3>
<p><strong>核心功能：存放“说明书的原始手稿”。</strong>
它里面全是文字和标记，<strong>不负责运行代码</strong>，<strong>不负责跑模型</strong>。它的唯一作用就是等着被一个叫 Sphinx 的“打印机程序”读取，然后生成你在浏览器里看到的那个漂亮的 HTML 文档网站。</p>
<h3>2. 各个文件/子文件夹分别是干什么的？</h3>
<ul>
<li><strong>📄 <code>index.rst</code>（总编室）</strong>：<ul>
<li>这是<strong>封面和目录</strong>。它决定了文档网站长什么样，第一页显示啥，左边导航栏有哪些章节。</li>
</ul>
</li>
<li><strong>📂 <code>user-guide/</code>（新手驾校）</strong>：<ul>
<li>这里面的文章是写给<strong>人</strong>看的。比如“如何安装”、“十分钟快速上手”。</li>
<li><strong>比喻</strong>：教你“左边刹车，右边油门”。</li>
</ul>
</li>
<li><strong>📂 <code>api-guide/</code>（维修字典）</strong>：<ul>
<li>这里面的文章是写给<strong>老司机</strong>查阅的。列出了所有函数的参数、返回值类型。</li>
<li><strong>比喻</strong>：零件清单，写着“螺丝型号 M5，扭矩 20Nm”。</li>
</ul>
</li>
</ul>
<h3>3. 高层认知：一句话理解这部分代码</h3>
<p><strong>请把这个文件夹看作：Megatron 的“宣传与文档部”。</strong></p>
<ul>
<li>外面的 Python 代码是<strong>造车的</strong>（干实事）。</li>
<li>这里的 <code>source</code> 目录是<strong>写说明书的</strong>（耍笔杆子）。</li>
<li>如果你不打算给 Megatron 贡献文档，<strong>你完全可以忽略这个文件夹</strong>，它不会影响你跑代码。</li>
</ul>