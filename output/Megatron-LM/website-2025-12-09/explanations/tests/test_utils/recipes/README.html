<h1>tests/test_utils/recipes</h1>
<p>好的，这个文件夹 <code>tests/test_utils/recipes</code> 的名字非常直观，它就叫 <strong>“食谱” (Recipes)</strong>。</p>
<p>为了让你秒懂，我们把整个 Megatron-LM 项目想象成一家 <strong>“米其林三星 AI 餐厅”</strong>。</p>
<hr />
<h3>1. 当前这个文件夹主要负责什么功能？</h3>
<p><strong>这就是餐厅的“后厨菜单大全”</strong>。</p>
<ul>
<li><strong>你的 CI/CD 测试系统</strong> 就是 <strong>“机器人大厨”</strong>。</li>
<li><strong>这个文件夹</strong> 里装的，就是给这位机器人大厨看的一张张 <strong>“烹饪说明书”</strong>。</li>
</ul>
<p>它的核心功能是：<strong>告诉测试机器人，针对不同的“菜品”（AI 模型），应该怎么备料、用什么锅、烧多久，最后怎么才算做熟了。</strong></p>
<p>如果没有这个文件夹，机器人大厨就不知道该怎么测试代码，可能会把 GPT 模型扔进 BERT 的锅里煮，或者忘了放盐（参数配置错误）。</p>
<hr />
<h3>2. 这个文件夹下的各个文件分别是干什么的？</h3>
<p>既然是菜单，里面的每一个 YAML 文件就是一道 <strong>“具体的菜谱”</strong>。</p>
<ul>
<li><strong><code>gpt.yaml</code> / <code>gpt-*.yaml</code></strong>：<ul>
<li>这是餐厅的 <strong>“招牌红烧肉”</strong>。</li>
<li>告诉机器人：如何测试 <strong>GPT</strong> 模型。怎么切分数据（并行策略）、火候要多大（参数设置）、要不要加特效（动态推理/静态推理）。</li>
</ul>
</li>
<li><strong><code>bert.yaml</code> / <code>t5.yaml</code></strong>：<ul>
<li>这是 <strong>“经典家常菜”</strong>。</li>
<li>告诉机器人：如何测试 <strong>BERT</strong> 和 <strong>T5</strong> 这种经典的旧模型，确保新代码没把老味道搞砸。</li>
</ul>
</li>
<li><strong><code>moe.yaml</code> / <code>moe-*.yaml</code></strong>：<ul>
<li>这是 <strong>“复杂的佛跳墙”</strong>。</li>
<li>MoE (混合专家模型) 结构很复杂。这些文件告诉机器人：怎么把这道复杂的菜拆开来煮（专家并行），怎么分配到不同的锅里（多卡测试）。</li>
</ul>
</li>
<li><strong><code>mamba.yaml</code> / <code>mimo.yaml</code></strong>：<ul>
<li>这是 <strong>“当季新品”</strong>。</li>
<li>Mamba 和 MIMO 是较新的架构。这些食谱专门用来测试这些新模型能不能跑通。</li>
</ul>
</li>
<li><strong><code>multimodal-llava.yaml</code></strong>：<ul>
<li>这是 <strong>“创意融合菜”</strong>。</li>
<li>LLaVA 是多模态（看图说话）模型。这个食谱告诉机器人：不仅要准备文字，还要准备图片数据来做测试。</li>
</ul>
</li>
<li><strong><code>unit-tests.yaml</code></strong>：<ul>
<li>这是 <strong>“餐具卫生检查”</strong>。</li>
<li>它不煮大菜，而是快速检查每一个小零件（单元测试）是不是干净、好用的。</li>
</ul>
</li>
<li><strong><code>ckpt_converter.yaml</code></strong>：<ul>
<li>这是 <strong>“打包外卖流程”</strong>。</li>
<li>测试模型的存档（Checkpoint）能不能在不同格式间转换，就像测试能不能把堂食的菜完美装进外卖盒里。</li>
</ul>
</li>
</ul>
<hr />
<h3>3. 给我一个高层的认知，快速理解这部分代码</h3>
<p>要把这部分代码看作 <strong>“连接器” (The Bridge)</strong>。</p>
<p>想象三个要素：
1.  <strong>左边是“食材”</strong>：你写的 Python 代码（Megatron-LM 源码）。
2.  <strong>右边是“灶台”</strong>：昂贵的显卡服务器（NVIDIA H100/A100）。
3.  <strong>中间就是这个文件夹</strong>：<strong>调度中心</strong>。</p>
<p><strong>它的工作流是这样的：</strong>
1.  你提交了代码（进了食材）。
2.  系统读取 <code>recipes</code> 里的文件（拿出食谱）。
3.  系统根据食谱，去申请对应的显卡（开火）。
4.  系统按食谱步骤运行你的代码（烹饪）。
5.  最后尝一口（对比 Golden Values），告诉你：<strong>“这道菜做成了（Pass）”</strong> 还是 <strong>“做糊了（Fail）”</strong>。</p>
<p><strong>一句话总结：</strong>
<strong>这是给自动化测试机器人看的“操作手册”，每一种模型（GPT, BERT, MoE）都有一本专属手册，确保它们在昂贵的显卡上能正确地跑起来。</strong></p>