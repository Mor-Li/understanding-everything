<h1>.github/actions/check-nvidia-sso-membership/action.yml</h1>
<p>这份文件是一个 <strong>GitHub Action</strong> 的定义文件。简单来说，它就是一个<strong>自动化脚本</strong>。</p>
<p>它的核心目的是：<strong>判断某个人（GitHub 用户）是不是 NVIDIA 的内部员工（或 SSO 认证成员）。</strong></p>
<p>为了让你听懂，我们可以把这个脚本想象成一个<strong>大楼保安</strong>。当有人想进大楼时，保安需要执行一套标准的<strong>任务清单 (To-Do List)</strong>。</p>
<p>下面我把代码逻辑拆解成这个保安的“工作流程”：</p>
<h3>📋 保安的任务清单 (Task To-Do List)</h3>
<ol>
<li>
<p><strong>准备阶段 (Inputs)</strong>：</p>
<ul>
<li>拿到来访者的名字（GitHub Username）。</li>
<li>拿到去哪里查名单的钥匙（GitHub Token）。</li>
<li>确认去哪个档案室找名单（仓库地址和文件名）。</li>
</ul>
</li>
<li>
<p><strong>第一步：获取名单 (Step 1: Download)</strong></p>
<ul>
<li>跑到指定的档案室（GitHub 仓库），把最新的“员工名单”（JSON 文件）下载下来。</li>
<li><em>检查点</em>：名单下载成功了吗？如果没成功，任务结束，标记为“没拿到名单”。</li>
<li><em>检查点</em>：名单格式对不对？是不是一份合法的名单？</li>
</ul>
</li>
<li>
<p><strong>第二步：核对身份 (Step 2: Check Membership)</strong></p>
<ul>
<li>打开刚才下载的名单。</li>
<li><em>搜索</em>：来访者的名字在名单里吗？<ul>
<li><strong>不在</strong> -&gt; 汇报：这就不是我们要找的人 (<code>is_member = false</code>)。</li>
<li><strong>在</strong> -&gt; 汇报：是内部人员 (<code>is_member = true</code>)。</li>
</ul>
</li>
<li><em>进一步检查</em>：如果他在名单里，他具体属于哪个部门？（是不是 NVIDIA 核心组或 NeMo 组的成员？）<ul>
<li>如果是，汇报：他是核心成员 (<code>is_org_member = true</code>)。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>汇报阶段 (Outputs)</strong></p>
<ul>
<li>把查到的所有结果写在表格上，交给上级（后续的自动化流程）。</li>
</ul>
</li>
</ol>
<hr />
<h3>🔍 逐步详细讲解 (对应代码内容)</h3>
<p>现在我们对照着文件内容，一步一步看它是怎么实现上面这个流程的：</p>
<h4>1. 开头部分 (基本信息)</h4>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Check</span><span class="nv"> </span><span class="s">NVIDIA</span><span class="nv"> </span><span class="s">SSO</span><span class="nv"> </span><span class="s">Membership&#39;</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Check</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">GitHub</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">exists...&#39;</span>
</code></pre></div>

<ul>
<li>这只是给脚本起个名，叫“检查 NVIDIA SSO 成员资格”。</li>
</ul>
<h4>2. Inputs (输入/准备材料)</h4>
<p>这是告诉使用者：<strong>你想让我干活，得给我提供什么信息？</strong></p>
<ul>
<li><code>username</code>: <strong>必填</strong>。你要查谁？</li>
<li><code>github_audits_repo</code>: 名单存在哪个仓库里？（默认是 <code>NVIDIA-GitHub-Management/github-audits</code>）。</li>
<li><code>github_token</code>: <strong>必填</strong>。下载名单需要权限，得给个令牌（密码）。</li>
<li><code>sso_users_filename</code>: 名单文件叫啥名？（默认是 <code>users_sso.json</code>）。</li>
</ul>
<h4>3. Runs - Step 1: 下载名单 (Download NVIDIA SSO users...)</h4>
<p>这段代码是用 <code>bash</code> (Linux 命令) 写的。</p>
<ul>
<li><strong><code>gh release download ...</code></strong>:<ul>
<li>这是核心动作。它使用 GitHub 官方命令行工具 (<code>gh</code>) 去你指定的仓库下载那个 <code>users_sso.json</code> 文件。</li>
</ul>
</li>
<li><strong><code>if [ ! -f ... ]</code> 和 <code>jq -e 'type == "object"'</code></strong>:<ul>
<li>这是<strong>安检</strong>。下载完之后，它会检查：文件真的存在吗？文件内容是正确的 JSON 格式吗？</li>
<li>如果出错了，它会输出 <code>sso_file_available=false</code>（名单不可用），然后退出。</li>
</ul>
</li>
<li><strong><code>USER_COUNT=$(jq 'length' ...)</code></strong>:<ul>
<li>它顺便数了一下名单里有多少人，并记录下来。</li>
</ul>
</li>
</ul>
<h4>4. Runs - Step 2: 查名字 (Check if user is in SSO list)</h4>
<p>这是逻辑判断的核心部分。</p>
<ul>
<li><strong><code>if jq -e --arg user "$USERNAME" 'has($user)' ...</code></strong>:<ul>
<li>它用 <code>jq</code> 工具在 JSON 文件里查找：<strong>“这个用户名是名单里的一个 Key 吗？”</strong></li>
<li>如果找到了，它就输出 <code>is_member=true</code>。</li>
</ul>
</li>
<li><strong><code>IS_ORG_MEMBER=$(jq ...)</code></strong>:<ul>
<li>如果人找到了，它会继续深挖。它查看这个人的 <code>org_roles</code>（组织角色）字段。</li>
<li>它用正则 <code>^(NVIDIA|NVIDIA-NeMo):Member$</code> 来判断：这个人是不是 <code>NVIDIA</code> 或者 <code>NVIDIA-NeMo</code> 这两个组织的 Member。</li>
</ul>
</li>
<li><strong><code>echo "is_org_member=$IS_ORG_MEMBER" &gt;&gt; $GITHUB_OUTPUT</code></strong>:<ul>
<li>把判断结果（是或否）写入输出，供后续使用。</li>
</ul>
</li>
</ul>
<h4>5. Outputs (输出/汇报结果)</h4>
<p>脚本跑完后，会吐出以下结果供其他人使用：</p>
<ul>
<li><code>is_member</code>: <strong>最重要</strong>。是（true）还是否（false）。</li>
<li><code>is_org_member</code>: 是不是核心组织成员。</li>
<li><code>user_orgs</code>: 这个人加入了哪些组织（列出一个列表）。</li>
<li><code>sso_file_available</code>: 名单下载成功了吗。</li>
</ul>
<h3>总结</h3>
<p>这个文件的作用就是<strong>“身份验证器”</strong>。
在 GitHub 的自动化流程（CI/CD）中，如果有人提交了代码，系统可能会调用这个 Action 来检查：“提交代码的这个人，是不是我们在册的 NVIDIA 员工？” 如果是，可能就自动通过；如果不是，可能需要额外审核。</p>