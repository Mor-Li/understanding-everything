<h1>docs/start/ray_debug_tutorial.rst</h1>
<p>没问题。这篇文档其实是在教你<strong>“如何在分布式环境（Ray）下调试代码”</strong>。</p>
<p>因为 Ray 是用来做分布式计算的，代码可能运行在不同的机器（Cluster）上，所以不能像平时在本地写 Python 那样直接打断点调试。这篇文档提供了两种方法，其中主要推荐的是使用 <strong>VSCode 插件</strong>的方法。</p>
<p>为了让你更容易理解，我把你当作一个开发者，我们要完成一个<strong>“配置并调试 Ray 程序”</strong>的任务。</p>
<p>以下是你需要完成的 <strong>Todo List</strong>，按照顺序列出：</p>
<hr />
<h3>📋 任务清单：使用 VSCode 调试 Ray 程序</h3>
<h4>✅ 第一步：准备工具 (安装插件)</h4>
<p><strong>原文对应：</strong> <em>Ray Distributed Debugger VSCode Extension</em> 第1点
*   <strong>你需要做啥：</strong> 打开你的 VSCode，去插件市场搜索并安装 <strong>"Ray Distributed Debugger"</strong> 这个插件。
*   <strong>解释：</strong> 这是官方出的神器，它能把远程机器上的运行状态“拉”到你的 VSCode 里显示。安装好后，你需要把你 Ray 集群的 Dashboard URL（比如 <code>http://127.0.0.1:8265</code>）填进去连接上。</p>
<h4>✅ 第二步：检查依赖 (安装库)</h4>
<p><strong>原文对应：</strong> <em>Prerequisites</em>
*   <strong>你需要做啥：</strong> 确保你的 Python 环境里安装了符合版本的库：
    *   <code>ray[default]</code> 版本要大于等于 <code>2.9.1</code>
    *   <code>debugpy</code> 版本要大于等于 <code>1.8.0</code>
*   <strong>解释：</strong> 这是调试器的底层依赖，版本太低跑不起来。</p>
<h4>✅ 第三步：设置环境变量 (关键开关)</h4>
<p><strong>原文对应：</strong> <em>Environment Variables</em>
*   <strong>你需要做啥：</strong> 在运行代码的终端里，输入：
    <code>export RAY_DEBUG_POST_MORTEM=1</code>
*   <strong>特别注意：</strong> 文档特意强调，<strong>不要</strong>使用旧的标志（比如 <code>RAY_DEBUG=legacy</code> 或 <code>--ray-debugger-external</code>）。如果有，一定要删掉。
*   <strong>解释：</strong> 这个变量告诉 Ray：“嘿，如果有错误或者断点，别直接崩溃退出，停下来等我调试。”</p>
<h4>✅ 第四步：埋点 (写代码)</h4>
<p><strong>原文对应：</strong> <em>Configuring Breakpoints</em>
*   <strong>你需要做啥：</strong> 在你的 Python 代码里，你想暂停的地方写上 <code>breakpoint()</code>。
*   <strong>限制条件：</strong> 这个 <code>breakpoint()</code> 必须写在被 <code>@ray.remote</code> 装饰的函数里面。
*   <strong>解释：</strong> 告诉程序运行到这里就“卡住”，等待你来检查变量。</p>
<h4>✅ 第五步：启动程序</h4>
<p><strong>原文对应：</strong> <em>Launching the Debugger</em>
*   <strong>你需要做啥：</strong> 在终端直接用 Python 运行你的脚本，比如：
    <code>python job.py</code>
*   <strong>注意：</strong> 不要用 VSCode 自带的那个 F5 调试配置（launch.json），直接命令行跑。</p>
<h4>✅ 第六步：接入调试 (Attach)</h4>
<p><strong>原文对应：</strong> <em>Attaching to a Breakpoint</em>
*   <strong>你需要做啥：</strong>
    1. 程序运行后，会卡在你写的 <code>breakpoint()</code> 那里。
    2. 这时看 VSCode 左侧侧边栏，点击那个 Ray 的图标。
    3. 点击连接（Attach）按钮。
*   <strong>解释：</strong> 这时候你的 VSCode 就会进入调试模式，你可以像在本地一样查看变量值、单步执行了。</p>
<h4>✅ 第七步：处理下一个断点 (如果还有的话)</h4>
<p><strong>原文对应：</strong> <em>Debugging With Multiple breakpoint()</em>
*   <strong>你需要做啥：</strong> 如果你有很多个任务（Task），调试完当前这个后，你需要先<strong>断开连接</strong>（Disconnect），然后再次点击插件图标去 <strong>Attach</strong> 下一个。
*   <strong>解释：</strong> 分布式调试比较特殊，它是一个个任务来的，不能像本地那样一直流式调试下去，得“断开-重连”循环。</p>
<hr />
<h3>👴 备选方案：老旧的方法 (Legacy Ray Debugger)</h3>
<p>文档最后提了一嘴“老方法”，你可以理解为<strong>“不推荐，除非你没法用 VSCode”</strong>。</p>
<ul>
<li><strong>原理：</strong> 不用图形界面，纯靠命令行。</li>
<li><strong>做法：</strong> 启动 Ray 集群时加上 <code>RAY_DEBUG=legacy</code> 参数。</li>
<li><strong>调试：</strong> 代码跑起来后，在终端输入 <code>ray debug</code> 命令，然后在黑框框里输入命令来查看变量。</li>
<li><strong>评价：</strong> 很原始，很难用，知道有这回事就行。</li>
</ul>
<h3>总结</h3>
<p>这篇文档核心就是告诉你：<strong>别用老土的命令行调试了，快去下载 VSCode 插件，设置好环境变量 <code>RAY_DEBUG_POST_MORTEM=1</code>，然后在代码里写 <code>breakpoint()</code> 就能像调试本地代码一样调试分布式集群了。</strong></p>