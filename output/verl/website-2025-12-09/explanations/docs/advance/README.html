<h1>docs/advance</h1>
<p>好的，如果把 <code>verl</code> 这个强化学习训练框架比作<strong>一辆赛车</strong>，那么 <code>docs/basic</code> 可能是教你怎么把车开动（考驾照），而 <code>docs/advance</code> 这个文件夹就是<strong>“F1 赛车改装与调校车间”</strong>。</p>
<p>这里不讲怎么“开车”，而是讲怎么<strong>换引擎、加氮气、改空气动力学</strong>，目的是让你的模型训练<strong>跑得更快、载得更重、省油（省显存）且不翻车</strong>。</p>
<hr />
<h3>1. 这个文件夹主要负责什么功能？</h3>
<p><strong>核心功能：性能压榨、规模扩展与定制化改造。</strong></p>
<p>这里的文档是给<strong>进阶玩家</strong>看的，解决的是在大规模、高强度训练中遇到的“硬骨头”问题：
*   <strong>嫌慢？</strong> 教你用异步（Async）、FP8 量化、Flash Attention 来加速。
*   <strong>模型太大？</strong> 教你用 Megatron、FSDP、LoRA 把大模型塞进显卡。
*   <strong>想魔改？</strong> 教你自定义 Agent 的思考回路、自定义奖励函数、自定义新算法（如 DPO）。
*   <strong>怕失控？</strong> 教你装监控仪表盘（Grafana）、行车记录仪（Trace）和存盘点（Checkpoint）。</p>
<hr />
<h3>2. 各个文件是干什么的？（改装车间分区介绍）</h3>
<p>为了方便理解，我把这些文件分到了车间的不同“工位”：</p>
<h4>🛠️ 工位 A：动力与加速（让训练飞起来）</h4>
<ul>
<li><strong><code>fully_async.md</code> / <code>one_step_off.md</code> / <code>async-on-policy-distill.md</code></strong>：<ul>
<li><em>比喻</em>：<strong>流水线改造</strong>。以前是“切完菜再炒菜”，现在是“一边切一边炒”。通过让生成数据（Rollout）和训练（Train）同时进行，甚至允许用稍微旧一点的数据（Off-policy），让 GPU 永不空转。</li>
</ul>
</li>
<li><strong><code>fp8.md</code></strong>：<ul>
<li><em>比喻</em>：<strong>把燃料压缩</strong>。用 8-bit 的低精度数据代替 16-bit，跑得更快，显存占用更少。</li>
</ul>
</li>
<li><strong><code>attention_implementation.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>更换涡轮增压器</strong>。教你切换 Flash Attention（最快）还是 Eager 模式（最稳，适合修车调试）。</li>
</ul>
</li>
<li><strong><code>rollout_skip.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>跳过重复剧情</strong>。如果这局游戏玩过了，直接读档，不用重新生成数据，省时间。</li>
</ul>
</li>
</ul>
<h4>🏗️ 工位 B：底盘与承重（搞定超大模型）</h4>
<ul>
<li><strong><code>fsdp_extension.rst</code> / <code>megatron_extension.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>把大象切块装冰箱</strong>。当模型大到一张卡装不下时，教你用 FSDP 或 Megatron 技术把模型切碎了放在不同的显卡上跑。</li>
</ul>
</li>
<li><strong><code>ppo_lora.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>外挂式升级</strong>。不动原本的大引擎，只在外面挂一个小马达（LoRA）进行微调，省钱省显存。</li>
</ul>
</li>
<li><strong><code>rope.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>扩容大脑内存</strong>。强行开启长文本模式，让模型能记住更长的对话。</li>
</ul>
</li>
</ul>
<h4>🧠 工位 C：驾驶逻辑与技能（教 AI 怎么思考）</h4>
<ul>
<li><strong><code>agent_loop.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>给 AI 写剧本</strong>。教它不仅仅是“问答”，而是学会“思考 -&gt; 查工具 -&gt; 再思考 -&gt; 回答”的多步循环。</li>
</ul>
</li>
<li><strong><code>dpo_extension.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>新武功秘籍</strong>。教你如何在现有的框架上，像搭积木一样实现 DPO 这种特定的训练算法。</li>
</ul>
</li>
<li><strong><code>reward_loop.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>阅卷老师管理</strong>。教你怎么给 AI 的作业打分，是用死板的规则，还是请另一个 AI（Reward Model）来打分。</li>
</ul>
</li>
</ul>
<h4>📊 工位 D：仪表盘与安全（监控与存盘）</h4>
<ul>
<li><strong><code>checkpoint.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>游戏存档</strong>。教你在训练中途怎么安全地保存进度，以及怎么把碎成渣的文件拼回一个完整的模型。</li>
</ul>
</li>
<li><strong><code>grafana_prometheus.md</code> / <code>rollout_trace.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>赛车仪表盘与黑匣子</strong>。实时监控显卡有没有偷懒，记录 AI 每一步思考的轨迹，方便出问题时复盘。</li>
</ul>
</li>
<li><strong><code>placement.rst</code></strong>：<ul>
<li><em>比喻</em>：<strong>排座位</strong>。指挥 Ray 框架把哪些进程放在哪些显卡上。</li>
</ul>
</li>
</ul>
<hr />
<h3>3. 高层认知（一句话看懂这个目录）</h3>
<p><strong><code>docs/advance</code> 就是一套“工业级 AI 训练流水线”的优化手册。</strong></p>
<ul>
<li><strong>Basic 是手工作坊</strong>：你写一行代码，跑一步，能跑通就行。</li>
<li><strong>Advance 是现代工厂</strong>：<ul>
<li>它把“思考（生成）”和“学习（训练）”拆开，让不同的工种（GPU）<strong>异步并行</strong>（Async）；</li>
<li>它把巨大的模型<strong>切片</strong>分发（FSDP/Megatron）；</li>
<li>它给整个流程装上了<strong>精密监控</strong>（Trace/Grafana）。</li>
</ul>
</li>
</ul>
<p><strong>读这个文件夹，就是为了从“能跑通代码”进阶到“能高效、低成本地训练几百亿参数的大模型”。</strong></p>