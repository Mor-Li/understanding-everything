<h1>docs/preparation/prepare_data.rst</h1>
<p>这份文档确实写得比较“硬核”，因为它主要是给开发人员看的各种代码片段。</p>
<p>简单来说，这份文档的核心目的是：<strong>教你怎么把原始数据（比如网上的题目和答案），处理成这个训练框架（Verl）能“吃”进去的标准格式（Parquet文件）。</strong></p>
<p>这就好比你要给AI做饭（训练），但AI只吃切成特定形状（格式）的菜。这份文档就是教你<strong>切菜的步骤</strong>。</p>
<p>我为你整理了一个 <strong>Task To-Do List</strong>，把文中复杂的逻辑拆解成 4 个具体的步骤：</p>
<hr />
<h3>📋 数据准备 To-Do List</h3>
<ol>
<li><strong>[获取食材] 下载原始数据</strong><ul>
<li>从 HuggingFace 等地方加载原始数据集。</li>
</ul>
</li>
<li><strong>[核心步骤] 编写“转换函数” (<code>make_map_fn</code>)</strong><ul>
<li>这是最重要的一步。你需要写一段代码，把原始杂乱的数据，整理成框架要求的 <strong>5个标准字段</strong>。</li>
</ul>
</li>
<li><strong>[提取答案] 处理正确答案 (<code>extract_solution</code>)</strong><ul>
<li>为了后续能奖励模型（Reward），你需要把标准答案从文本里干净地提取出来。</li>
</ul>
</li>
<li><strong>[打包上桌] 保存为 Parquet 格式</strong><ul>
<li>将处理好的数据保存为 <code>.parquet</code> 文件，放到指定文件夹。</li>
</ul>
</li>
</ol>
<hr />
<h3>💡 详细步骤讲解</h3>
<p>下面我结合文档内容，一步步给你讲这四个步骤具体在干什么：</p>
<h4>Step 1: 下载原始数据</h4>
<p>文档代码的第一部分就是在做这件事。
*   <strong>原文逻辑</strong>：使用 <code>datasets.load_dataset</code> 加载数据。
*   <strong>你的任务</strong>：确定你要训练什么数据（比如 GSM8K 数学题），然后把它加载到内存里。</p>
<h4>Step 2: 编写“转换函数” (关键！)</h4>
<p>文档中反复提到的 <code>make_map_fn</code> 就是这个转换器。不管你的原始数据长什么样，经过这个函数后，每一条数据<strong>必须</strong>包含以下 <strong>5个标准字段</strong>（这是框架规定的“切菜标准”）：</p>
<table>
<thead>
<tr>
<th style="text-align: left;">字段名</th>
<th style="text-align: left;">解释</th>
<th style="text-align: left;">例子</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>data_source</strong></td>
<td style="text-align: left;">数据来源的名字，用来区分不同任务。</td>
<td style="text-align: left;"><code>"openai/gsm8k"</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>prompt</strong></td>
<td style="text-align: left;"><strong>给AI看的问题</strong>。必须是对话格式（Chat Template）。</td>
<td style="text-align: left;"><code>[{"role": "user", "content": "1+1等于几？"}]</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>ability</strong></td>
<td style="text-align: left;">任务的能力标签。</td>
<td style="text-align: left;"><code>"math"</code> (数学), <code>"coding"</code> (代码)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>reward_model</strong></td>
<td style="text-align: left;"><strong>给评判系统看的答案</strong>。用来判断AI回答得对不对。</td>
<td style="text-align: left;"><code>{"style": "rule", "ground_truth": "2"}</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>extra_info</strong></td>
<td style="text-align: left;">额外的备注信息（目前暂时不用，但得有）。</td>
<td style="text-align: left;"><code>{"split": "train", "index": 10}</code></td>
</tr>
</tbody>
</table>
<p><strong>文档中的例子：</strong>
它展示了如何处理 GSM8K 数据集。它把原始数据里的 <code>question</code> 塞进了 <code>prompt</code>，把 <code>answer</code> 处理后塞进了 <code>reward_model</code>。</p>
<h4>Step 3: 处理正确答案</h4>
<p>文档中提到了 <code>extract_solution</code> 函数。
*   <strong>背景</strong>：很多数据集的答案是一大段解释（比如：“因为...所以...答案是 #### 42”）。
*   <strong>你的任务</strong>：机器只需要知道最终数字是“42”来判断对错。所以你需要写个正则表达式（Regex），把 <code>####</code> 后面的数字提取出来，作为 <code>ground_truth</code>。</p>
<h4>Step 4: 保存为 Parquet 格式</h4>
<ul>
<li><strong>原文逻辑</strong>：<code>train_dataset.to_parquet(...)</code></li>
<li><strong>你的任务</strong>：把上面处理完的数据，存成 <code>.parquet</code> 文件。这是一种高效的数据存储格式，训练读取速度快。</li>
</ul>
<hr />
<h3>🚀 总结：你到底需要做什么？</h3>
<p>如果你要用这个框架训练一个新的数据集（假设叫 <code>MyData</code>），你只需要照猫画虎：</p>
<ol>
<li>创建一个 Python 脚本。</li>
<li><strong>复制</strong> 文档里 <code>make_map_fn</code> 的结构。</li>
<li><strong>修改</strong> 里面的逻辑：<ul>
<li>把 <code>MyData</code> 的问题填入 <code>prompt</code>。</li>
<li>把 <code>MyData</code> 的答案提取出来填入 <code>reward_model</code> 的 <code>ground_truth</code>。</li>
</ul>
</li>
<li>运行脚本，生成 <code>.parquet</code> 文件。</li>
<li>搞定！可以开始训练了。</li>
</ol>