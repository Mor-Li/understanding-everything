<h1>.github/workflows/.deprecate/e2e_eval_aime24.yml</h1>
<p>这份文件是一个 <strong>GitHub Actions 的自动化工作流配置文件</strong>。</p>
<p>简单来说，你可以把它想象成一个<strong>“全自动阅卷机器人”</strong>的<strong>“操作手册”</strong>。</p>
<p>每当程序员修改了代码并上传到 GitHub 时，这个机器人就会醒来，按照这份手册，去租一台带显卡（GPU）的电脑，下载代码，跑一遍数学竞赛题（AIME 2024），看看模型有没有变笨，最后把电脑退掉。</p>
<p>为了让你看懂，我把它拆解成一个 <strong>Task Todo List（任务清单）</strong>，然后一步步给你讲。</p>
<hr />
<h3>🤖 机器人的任务清单 (Todo List)</h3>
<ol>
<li><strong>[监听]</strong>：时刻盯着代码库，看有没有人修改了关键代码（比如 <code>main</code> 分支或 <code>recipe/r1</code> 里的代码）。</li>
<li><strong>[租房]</strong>：如果有变动，去云端（火山引擎）租一台带 GPU 的服务器。</li>
<li><strong>[进场]</strong>：在租来的服务器上配置环境（下载代码、安装 Python 包、设置国内镜像加速）。</li>
<li><strong>[备考]</strong>：准备 AIME 2024 数学竞赛的题目数据。</li>
<li><strong>[考试]</strong>：运行 AI 模型，让它做题，并计算分数（端到端测试）。</li>
<li><strong>[退房]</strong>：不管考得怎么样，最后都要把服务器退掉，省钱。</li>
</ol>
<hr />
<h3>🧐 详细步骤讲解</h3>
<p>下面我结合文件内容，把上面 6 个步骤对应到代码里给你看：</p>
<h4>第 0 部分：文件开头的注释 (前 20 行)</h4>
<p>这部分全是 <code>#</code> 开头的，是写给程序员看的<strong>说明书</strong>，机器人不执行。
*   <strong>讲了啥</strong>：它介绍了个项目的测试文件夹结构。比如 <code>tests/models</code> 是测模型的，<code>special_e2e</code> 是测端到端流程的。
*   <strong>重点</strong>：告诉大家这个文件属于 <code>e2e</code>（End-to-End，端到端）测试，也就是全流程跑一遍。</p>
<h4>第 1 步：[监听] 什么时候干活？</h4>
<p>对应代码中的 <code>on:</code> 部分。</p>
<div class="codehilite"><pre><span></span><code><span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">v0.*</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># 只要 main 分支有提交</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w">             </span><span class="c1"># 且修改的文件是 .py 结尾，或者是 recipe/r1 里的东西</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w">        </span><span class="c1"># 或者有人提了 PR 想合并代码时</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：机器人很精明，不是随便动的。<ul>
<li>如果你只改了 <code>README.md</code>（文档），它<strong>不</strong>干活（<code>!*.md</code>）。</li>
<li>如果你改了 <code>recipe/r1</code>（核心算法配方），它<strong>立马</strong>干活。</li>
</ul>
</li>
</ul>
<h4>第 2 步：[租房] 准备计算资源</h4>
<p>对应代码中的 <code>jobs: setup</code> 部分。</p>
<div class="codehilite"><pre><span></span><code><span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">setup</span><span class="p">:</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">create-runner</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volcengine/vemlp-github-runner@v1</span><span class="w"> </span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;create&quot;</span><span class="w"> </span><span class="c1"># 动作：创建</span>
<span class="w">          </span><span class="nt">mlp-image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${{</span><span class="nv"> </span><span class="s">env.IMAGE</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"> </span><span class="c1"># 用这个镜像</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：这个任务需要强大的显卡。GitHub 免费送的电脑跑不动 AI。所以这里调用了 <code>volcengine</code>（火山引擎）的接口，动态申请一台云服务器（Runner）。</li>
</ul>
<h4>第 3 步：[进场] 配置环境</h4>
<p>对应代码中的 <code>jobs: e2e_eval_aime24</code> 的前几步。</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="nt">e2e_eval_aime24</span><span class="p">:</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">setup</span><span class="w"> </span><span class="c1"># 等租好房再开始</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"> </span><span class="c1"># 在刚才租的机器上跑</span>
<span class="w">    </span><span class="nt">env</span><span class="p">:</span>
<span class="w">      </span><span class="nt">HF_ENDPOINT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://hf-mirror.com&quot;</span><span class="w"> </span><span class="c1"># 设置 HuggingFace 国内镜像，下载模型更快</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout...</span><span class="w"> </span><span class="c1"># 下载刚才上传的代码</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install the current repository</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip3 install ... # 安装依赖包</span>
<span class="w">          </span><span class="no">pip3 install math-verify ... # 安装专门验证数学题答案的工具</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：新电脑是空的，得先把代码拉下来，把该装的软件（pip 包）装好。特别注意它设置了 <code>HF_ENDPOINT</code>，说明这台机器可能在国内，需要镜像加速下载模型。</li>
</ul>
<h4>第 4 步：[备考] 准备数据</h4>
<p>对应代码中的 <code>Prepare aime24 dataset</code>。</p>
<div class="codehilite"><pre><span></span><code><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prepare aime24 dataset</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">ray stop --force #以此确保环境干净</span>
<span class="w">          </span><span class="no">python3 recipe/r1/data_process.py --task aime2024</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：运行一个 Python 脚本，把 AIME 2024 的数学题数据处理好，格式化成模型能读懂的样子。</li>
</ul>
<h4>第 5 步：[考试] 运行测试</h4>
<p>这是核心，对应代码中的 <code>Running generation and evaluation</code>。</p>
<div class="codehilite"><pre><span></span><code><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Running generation and evaluation in AIME 2024</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">ray stop --force</span>
<span class="w">          </span><span class="no">bash tests/special_e2e/run_r1_distill_qwen_aime24_eval.sh</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：运行一个 Shell 脚本 (<code>run_r1_distill_qwen_aime24_eval.sh</code>)。</li>
<li><strong>它在干啥</strong>：它应该会加载一个叫 Qwen（通义千问）的模型，用 R1（可能是 DeepSeek-R1 的复现算法）的方法，去跑刚才准备好的 AIME 2024 数学题，最后看能做对几道。如果报错或者分数太低，这个测试就会“挂掉”（Fail），程序员就会收到报警。</li>
</ul>
<h4>第 6 步：[退房] 清理资源</h4>
<p>对应代码中的 <code>jobs: cleanup</code>。</p>
<div class="codehilite"><pre><span></span><code><span class="w">  </span><span class="nt">cleanup</span><span class="p">:</span>
<span class="w">      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span><span class="w"> </span><span class="c1"># 无论前面考试通过还是挂科，这步必须执行</span>
<span class="w">      </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">destroy-runner</span>
<span class="w">          </span><span class="nt">with</span><span class="p">:</span>
<span class="w">            </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;destroy&quot;</span><span class="w"> </span><span class="c1"># 动作：销毁</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：云服务器按分钟计费，很贵。不管测试成功还是失败，最后必须把机器退了（Destroy），防止一直扣费。</li>
</ul>
<hr />
<h3>总结</h3>
<p>这文件就是个<strong>监工</strong>：
<strong>“只要有人改了 R1 算法的代码，就去火山引擎租台机器，跑一遍 AIME 2024 数学题测试，跑完赶紧把机器退了。”</strong></p>