<h1>tests/special_sanity</h1>
<p>这个文件夹 <code>tests/special_sanity</code> 是整个项目的<strong>“纪律检查委员会”</strong>。</p>
<p>如果说其他的测试文件夹（比如 <code>tests/e2e</code>）是在检查代码“能不能跑通”、“算得对不对”（<strong>能力问题</strong>），那么这个文件夹就是在检查代码“写得漂不漂亮”、“规不规范”（<strong>素质问题</strong>）。</p>
<p>下面我用最通俗的方式回答你的三个问题：</p>
<hr />
<h3>1. 当前这个文件夹主要负责什么功能？</h3>
<p><strong>核心功能：自动化代码安检（Sanity Check）。</strong></p>
<p>你可以把它想象成<strong>机场的安检口</strong>。
不管你的代码功能有多强大（哪怕你是要去拯救世界的），只要你：
*   没带证件（没写文档/注释）；
*   带了违禁品（用了被禁用的函数）；
*   衣冠不整（代码格式乱、文件名不对）；
*   填表不规范（提交记录写得乱七八糟）；</p>
<p>这个文件夹里的脚本就会<strong>无情地把你的代码拦下来</strong>，红灯报警，禁止你通过（禁止合并代码）。</p>
<hr />
<h3>2. 这个文件夹下的各个文件分别是干什么的？</h3>
<p>我把它们分成几组“安检员”，每组负责查不同的违规行为：</p>
<h4>👮 第一组：文档与注释警察 (强制你写说明书)</h4>
<ul>
<li><strong><code>check_api_docs.py</code></strong>：<strong>“公开接口检查员”</strong>。只要是给别人用的函数，必须写说明书（Docstring），否则不让过。</li>
<li><strong><code>check_docstrings.py</code></strong>：<strong>“核心区域检查员”</strong>。盯着那几个最重要的核心文件，没写注释就报错。</li>
<li><strong><code>validate_imported_docs.py</code></strong>：<strong>“引用检查员”</strong>。你代码里引用进来的工具，也必须有说明书。</li>
<li><strong><code>check_docs_time_info.py</code></strong>：<strong>“有效期检查员”</strong>。检查文档里有没有写“Last updated”时间，防止文档过期。</li>
</ul>
<h4>🚫 第二组：违禁品搜查队 (禁止使用特定写法)</h4>
<ul>
<li><strong><code>check_dataproto_usage.py</code></strong>：<strong>“DataProto 杀手”</strong>。全项目禁止使用 <code>DataProto</code>，抓到就报警，强迫你用 <code>TensorDict</code>。</li>
<li><strong><code>check_device_api_usage.py</code></strong>：<strong>“硬件中立卫士”</strong>。禁止直接写 <code>.cuda()</code> 或 <code>nccl</code>，强迫你用项目封装好的通用工具，为了兼容不同硬件。</li>
</ul>
<h4>📝 第三组：格式与流程管理员 (强迫症患者)</h4>
<ul>
<li><strong><code>check_license.py</code></strong>：<strong>“版权律师”</strong>。检查每个文件开头有没有写 <code>Copyright ...</code>，没写就是侵权风险。</li>
<li><strong><code>check_pr_title.py</code></strong>：<strong>“标题审核员”</strong>。提交代码的标题必须是 <code>[feat] model: ...</code> 这种格式，乱写直接打回。</li>
<li><strong><code>check_pr_description.py</code></strong>：<strong>“填表审核员”</strong>。提交代码的描述不能用默认模版，必须手写具体改了啥。</li>
<li><strong><code>test_config_docs.py</code></strong>：<strong>“排版老师”</strong>。专门检查 YAML 配置文件，要求必须有注释、必须空行隔开，排版要像艺术品一样。</li>
</ul>
<h4>🏗️ 第四组：结构与质量工头</h4>
<ul>
<li><strong><code>validate_structure.py</code></strong>：<strong>“归位管理员”</strong>。代码放在哪个文件夹是有讲究的，测试代码的目录结构必须和主代码一一对应，不能乱放。</li>
<li><strong><code>type_coverage_check.py</code></strong>：<strong>“语法老师”</strong>。强迫你在新代码里写类型注解（比如 <code>x: int</code>），没写够一定比例就不及格。</li>
</ul>
<hr />
<h3>3. 给我一个高层的认知，让我能快速理解这部分代码的作用</h3>
<p><strong>一句话总结：这是为了防止“破窗效应”的自动化城管。</strong></p>
<p>在一个几百人协作的大型开源项目中：
*   <strong>如果没有这些脚本：</strong> 程序员 A 偷懒没写注释，程序员 B 为了省事直接调了底层接口，程序员 C 乱建文件夹。一个月后，代码库就会变成一个<strong>垃圾场</strong>，谁也看不懂，谁也不敢改。
*   <strong>有了这些脚本：</strong> 它们通常运行在 <strong>CI（持续集成）</strong> 环节。也就是说，你每次提交代码，这些脚本都会自动运行一遍。<strong>它们是毫无感情的代码守门员，把所有不规范的苗头扼杀在摇篮里。</strong></p>
<p><strong>你的认知升级：</strong>
当你看到 <code>tests/special_sanity</code> 时，不要把它当成“测试业务逻辑”的代码。要把它看作是<strong>项目管理者的意志体现</strong> —— 它定义了这个项目“什么是好代码”，“什么是被允许的行为”。</p>