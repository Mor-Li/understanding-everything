<h1>tests/special_sanity/check_dataproto_usage.py</h1>
<p>这份代码其实是一个<strong>“代码警察”</strong>。它的工作是在代码仓库里巡逻，确保没人使用一个叫 <code>DataProto</code> 的东西。</p>
<p>这通常用于<strong>CI（持续集成）测试</strong>：当程序员提交代码时，这个脚本会自动运行。如果程序员偷偷用了 <code>DataProto</code>，这个脚本就会报错，阻止代码合并。</p>
<p>为了让你更容易理解，我把你当作这个脚本，给你列一个 <strong>Task Todo List（任务清单）</strong>。你只需要照着这 5 步做，就是这段代码的所有逻辑：</p>
<h3>📋 任务清单 (Task Todo List)</h3>
<h4>Task 1：确定巡逻范围 (接收参数)</h4>
<ul>
<li><strong>代码对应：</strong> <code>parser.add_argument...</code> 和 <code>args.directory</code></li>
<li><strong>你的动作：</strong> 别人命令你开始工作时，必须告诉你去哪个文件夹（Directory）检查。</li>
<li><strong>实际操作：</strong> 你拿到一个文件夹路径，比如 <code>src/my_project</code>。</li>
</ul>
<h4>Task 2：收集嫌疑文件 (遍历文件)</h4>
<ul>
<li><strong>代码对应：</strong> <code>Path(directory_in_str).glob("**/*.py")</code></li>
<li><strong>你的动作：</strong> 走进那个文件夹，把里面<strong>所有的</strong> Python 文件（<code>.py</code> 结尾）都找出来，列成一个清单。不管藏得多深（子文件夹）都要找出来。</li>
</ul>
<h4>Task 3：排除特权阶级 (白名单检查)</h4>
<ul>
<li><strong>代码对应：</strong> <code>SEARCH_WHITELIST</code> 和 <code>path_in_whitelist</code> 相关的循环。</li>
<li><strong>你的动作：</strong> 看着手里的文件清单，先查一下“白名单”（<code>SEARCH_WHITELIST</code>）。<ul>
<li>如果某个文件在白名单里，你就大喊一声：“[SKIP] 这个文件是特权文件，我不查它！”然后直接跳过，去查下一个。</li>
<li><em>注：代码里的白名单目前是空的 <code>[]</code>，所以这一步实际上谁也跳不过去，所有文件都要查。</em></li>
</ul>
</li>
</ul>
<h4>Task 4：搜身 (内容关键字搜索)</h4>
<ul>
<li><strong>代码对应：</strong> <code>with open(...)</code> 和 <code>for sk in SEARCH_KEYWORDS:</code></li>
<li><strong>你的动作：</strong><ol>
<li>打开当前这个 <code>.py</code> 文件。</li>
<li>从头到尾读一遍里面的代码内容。</li>
<li>看看有没有出现 <strong>"DataProto"</strong> 这个词（<code>SEARCH_KEYWORDS</code>）。</li>
<li>如果发现了这个词，就在心里记一笔：<code>find_invalid_device_management = True</code>（发现违禁品了！）。</li>
</ol>
</li>
</ul>
<h4>Task 5：宣判 (断言 Assert)</h4>
<ul>
<li><strong>代码对应：</strong> <code>assert not find_invalid_device_management</code></li>
<li><strong>你的动作：</strong><ul>
<li><strong>如果没有发现违禁词：</strong> 你打印一句 <code>[CHECK] ... success</code>，表示这个文件通过检查，安全。</li>
<li><strong>如果发现了 "DataProto"：</strong> 你直接<strong>报警并崩溃</strong>（报错退出）。</li>
<li><strong>报错信息是：</strong> <code>"file ... contains DataProto usage, please use TensorDict directly!"</code></li>
<li><strong>翻译过来就是：</strong> “抓到了！这个文件里用了 DataProto，不准用！请改用 TensorDict！”</li>
</ul>
</li>
</ul>
<hr />
<h3>总结一下</h3>
<p><strong>这个脚本的核心观点是：</strong>
在这个项目里，<strong>禁止使用 <code>DataProto</code></strong>，应该全面改用 <code>TensorDict</code>。</p>
<p><strong>它的工作流程是：</strong>
<code>读取指定目录</code> -&gt; <code>找到所有Python文件</code> -&gt; <code>打开文件找 "DataProto" 这个词</code> -&gt; <code>找到了就报错，没找到就通过</code>。</p>