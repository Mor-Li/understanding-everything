<h1>tests/README.md</h1>
<p>这份文档其实是写给开发者的<strong>“测试指南”</strong>。它告诉开发者：如果你要写测试代码，文件该放哪、名字该怎么起、以及系统会自动怎么运行这些测试。</p>
<p>为了让你听懂，我们假设<strong>你刚加入这个项目组</strong>，我作为组长给你布置了 <strong>4 个任务（Todo List）</strong>。跟着这四个任务走，你就完全懂了。</p>
<hr />
<h3>✅ Task 1：学会“归纳整理” (文件放哪里？)</h3>
<p><strong>目标：</strong> 搞清楚你的测试代码应该放在哪个文件夹里。</p>
<p><strong>文中的逻辑：</strong>
1.  <strong>照镜子原则：</strong> 源代码在哪里，测试代码就在 <code>tests/</code> 下对应的目录里。
    *   比如源代码在 <code>verl/trainer</code>，你的测试就放 <code>tests/trainer</code>。
    *   源代码在 <code>verl/models</code>，你的测试就放 <code>tests/models</code>。
2.  <strong>特殊情况特殊处理：</strong> 如果你的测试很特殊，就放在以 <code>special_</code> 开头的文件夹里。
    *   <code>special_distributed</code>：必须用多张显卡（多GPU）跑的测试。
    *   <code>special_e2e</code>：端到端（End-to-End）测试，就是从头到尾跑一遍完整流程。
    *   <code>special_npu</code>：专门给 NPU（另一种AI芯片）跑的测试。
    *   <code>special_sanity</code>：快速检查一下系统是不是疯了（Sanity check），跑得很快的基础测试。
    *   <code>special_standalone</code>：需要在隔离环境里跑的独立测试。</p>
<hr />
<h3>✅ Task 2：决定“用什么跑” (CPU 还是 GPU？)</h3>
<p><strong>目标：</strong> 告诉系统你的代码需要什么硬件资源。</p>
<p><strong>文中的逻辑：</strong>
1.  <strong>默认全用 GPU：</strong> 只要你什么都不做，系统默认给你分配 GPU 资源来跑测试。
2.  <strong>我想用 CPU 怎么办？</strong>
    *   <strong>改名字：</strong> 把你的测试脚本文件名后缀改成 <code>_on_cpu.py</code>（例如 <code>test_math_on_cpu.py</code>）。系统一看到这个后缀，就只给你分配 CPU。
3.  <strong>例外：</strong> 放在 <code>special_npu</code> 文件夹里的，当然是用 NPU 跑。</p>
<hr />
<h3>✅ Task 3：了解“自动流水线” (CI 怎么跑？)</h3>
<p><strong>目标：</strong> 知道当你把代码上传（Push）到 GitHub 后，后台会自动运行哪些检查（CI = 持续集成）。</p>
<p><strong>文中的逻辑：</strong>
所有的自动化配置都在 <code>.github/workflows/</code> 里。系统会按顺序或者并行做这 4 件事：</p>
<ol>
<li><strong>必做的基础检查（CPU Sanity）：</strong><ul>
<li>不管你改了啥，都会跑这些。比如检查你的代码格式、文档、PR标题合不合格。</li>
</ul>
</li>
<li><strong>重型测试（Heavy Multi-GPU）：</strong><ul>
<li>跑一些很吃资源的大模型测试（比如 <code>vllm.yml</code>, <code>sgl.yml</code>）。</li>
</ul>
</li>
<li><strong>全流程测试（End-to-End）：</strong><ul>
<li>文件名叫 <code>e2e_*.yml</code> 的配置，确保整个软件能跑通。</li>
</ul>
</li>
<li><strong>单元测试（Unit Tests）：</strong><ul>
<li><strong>CPU 单元测试：</strong> 专门跑所有名字里带 <code>_on_cpu.py</code> 的文件。</li>
<li><strong>GPU 单元测试：</strong> 跑所有名字里<strong>不带</strong> <code>_on_cpu.py</code> 的文件。</li>
</ul>
</li>
</ol>
<hr />
<h3>✅ Task 4：遵守“交通规则” (避免重复)</h3>
<p><strong>目标：</strong> 防止同一个测试被跑了两次，浪费资源。</p>
<p><strong>文中的逻辑（最后一段）：</strong>
*   <strong>背景：</strong> 既然“GPU 单元测试”默认会跑 <code>tests/</code> 目录下所有的文件。
*   <strong>问题：</strong> 如果你新写了一个“重型多卡测试”（属于 Task 3 中的第2类），系统会自动跑它。但“GPU 单元测试”也会扫描到它再跑一遍。
*   <strong>规则：</strong> 当你添加新的工作流（Workflow）或者新的重型测试时，<strong>请手动在 <code>gpu_unit_tests.yml</code> 里把它们排除掉（Exclude）</strong>。</p>
<hr />
<h3>总结</h3>
<p>这篇文档就讲了三件事：
1.  <strong>分门别类</strong>：普通测试对应放，特殊测试放 <code>special_</code>。
2.  <strong>命名定硬件</strong>：想用 CPU 跑，文件名记得加 <code>_on_cpu.py</code>。
3.  <strong>别跑重了</strong>：如果配置了专门的测试流程，记得去通用测试里把它剔除。</p>