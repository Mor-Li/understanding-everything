<h1>.github/workflows/e2e_ascend.yml</h1>
<p>这份文件是一个 <strong>GitHub Actions 的自动化工作流配置文件</strong>（Workflow）。</p>
<p>简单来说，它的作用是：<strong>“每当有代码更新时，自动在华为昇腾（Ascend NPU）芯片的服务器上，把这一套 AI 训练流程跑一遍，确保代码在华为硬件上能正常工作。”</strong></p>
<p>为了让你看懂，我把这个文件拆解成一个 <strong>项目经理分派给测试员的 To-Do List（任务清单）</strong>。想象你就是那个测试员（GitHub Action），你需要按顺序执行以下任务：</p>
<hr />
<h3>📋 任务清单：华为昇腾 (Ascend) 环境端到端测试</h3>
<h4>第一阶段：接单与准备 (什么时候开始？)</h4>
<blockquote>
<p>对应文件中的 <code>on</code> 和 <code>jobs</code> 开头部分</p>
</blockquote>
<ul>
<li>[ ] <strong>Task 1: 确认是否需要干活</strong><ul>
<li><strong>检查触发条件</strong>：有人往 <code>main</code> 分支提交了代码（Push），或者有人提交了合并请求（PR）且修改了核心文件（如 <code>verl/</code> 目录、<code>setup.py</code> 等）。</li>
<li><strong>检查身份</strong>：确认仓库所有者是 <code>volcengine</code>（字节跳动火山引擎），防止别人 Fork 后乱跑浪费资源。</li>
</ul>
</li>
<li>[ ] <strong>Task 2: 找台机器坐下</strong><ul>
<li><strong>寻找硬件</strong>：找一台 <code>linux-aarch64</code> 架构的机器（这是华为昇腾服务器常见的架构）。</li>
<li><strong>配置环境</strong>：启动一个 Docker 容器，镜像要用华为专门提供的 <code>ascend-ci/verl...</code>（里面预装了华为 NPU 的驱动和 CANN 软件栈）。</li>
<li><strong>设置网络</strong>：配置 HTTP 代理和 HuggingFace 镜像站（方便下载模型和数据）。</li>
</ul>
</li>
</ul>
<h4>第二阶段：搭建舞台 (环境安装)</h4>
<blockquote>
<p>对应文件中的 <code>steps</code> 前半部分</p>
</blockquote>
<ul>
<li>[ ] <strong>Task 3: 检查硬件状态</strong><ul>
<li>运行 <code>npu-smi info</code>，看看这台机器上的 NPU 卡是不是正常的（类似于显卡驱动检查）。</li>
</ul>
</li>
<li>[ ] <strong>Task 4: 把代码拿下来</strong><ul>
<li>运行 <code>checkout</code>，把 GitHub 仓库里的最新代码拉取到本地。</li>
</ul>
</li>
<li>[ ] <strong>Task 5: 安装软件依赖</strong><ul>
<li>运行 <code>pip install</code>，安装 <code>requirements-npu.txt</code>（华为 NPU 专用的依赖包）。</li>
<li>安装本项目 <code>pip install -e .</code>。</li>
</ul>
</li>
</ul>
<h4>第三阶段：准备食材 (数据处理)</h4>
<blockquote>
<p>对应文件中的 <code>Preprocess ...</code> 部分</p>
</blockquote>
<ul>
<li>[ ] <strong>Task 6: 准备 GSM8K 数据集</strong><ul>
<li>运行脚本处理 GSM8K 数据（这是一个数学题目数据集），为后面的数学推理训练做准备。</li>
</ul>
</li>
<li>[ ] <strong>Task 7: 准备 Geo3K 数据集</strong><ul>
<li>运行脚本处理 Geometry3K 数据（几何题目），为后面的多模态/视觉任务做准备。</li>
</ul>
</li>
</ul>
<h4>第四阶段：正餐开始 (核心训练测试)</h4>
<blockquote>
<p>这是文件的核心，对应一连串的 <code>Running ...</code> 步骤。
<strong>注意</strong>：每一步开始前都会运行 <code>ray stop --force</code>，意思是“先把之前的进程杀干净，释放内存，避免干扰”。</p>
</blockquote>
<ul>
<li>[ ] <strong>Task 8: 测试 PPO 算法 (Qwen3-0.6B)</strong><ul>
<li><strong>目标</strong>：验证在 NPU 上跑 PPO（一种强化学习算法）是否正常。</li>
<li><strong>动作</strong>：运行 <code>run_qwen3_06b_ppo.sh</code> 脚本。</li>
</ul>
</li>
<li>[ ] <strong>Task 9: 测试 SFT + PEFT (Qwen2.5-0.5B)</strong><ul>
<li><strong>目标</strong>：验证“监督微调 (SFT)”加上“参数高效微调 (PEFT/LoRA)”功能是否正常。</li>
<li><strong>动作</strong>：运行 <code>run_qwen2_5_05b_sft_peft_sp2.sh</code>。</li>
</ul>
</li>
<li>[ ] <strong>Task 10: 测试 GRPO 算法 (Qwen2.5-0.5B)</strong><ul>
<li><strong>目标</strong>：验证 GRPO（一种新的强化学习优化算法）是否正常。</li>
<li><strong>动作</strong>：运行 <code>run_qwen2_5_05b_grpo.sh</code>。</li>
</ul>
</li>
<li>[ ] <strong>Task 11: 测试视觉多模态 (Qwen2.5-VL)</strong><ul>
<li><strong>目标</strong>：验证能不能训练<strong>看图说话</strong>的模型（VL = Vision Language）。</li>
<li><strong>动作</strong>：运行 <code>run_qwen2_5_vl_3b_npu.sh</code>。</li>
</ul>
</li>
<li>[ ] <strong>Task 12: 测试 DAPO 算法</strong><ul>
<li><strong>目标</strong>：验证 DAPO 算法是否正常。</li>
<li><strong>动作</strong>：运行 <code>run_qwen2_5_05b_dapo.sh</code>。</li>
</ul>
</li>
</ul>
<h4>第五阶段：高难度挑战 (MindSpeed/Megatron 集成测试)</h4>
<blockquote>
<p>对应文件名带 <code>mindspeed</code> 的步骤。MindSpeed 是华为针对大模型优化的框架（基于 Megatron-LM）。</p>
</blockquote>
<ul>
<li>[ ] <strong>Task 13: 测试混合专家模型 (MoE) + MindSpeed</strong><ul>
<li><strong>目标</strong>：测试更复杂的 Qwen3-MoE 模型，并且结合 MindSpeed 框架进行分布式训练。</li>
<li><strong>动作</strong>：设置复杂的环境变量（如 <code>USE_DIST_CKPT</code>），然后运行 <code>run_qwen3_30b_dapo_mindspeed.sh</code>。</li>
</ul>
</li>
<li>[ ] <strong>Task 14: 测试 GRPO + MindSpeed</strong><ul>
<li><strong>目标</strong>：验证 GRPO 算法在 MindSpeed 框架下是否能跑通。</li>
<li><strong>动作</strong>：运行 <code>run_qwen2_5_05b_grpo_mindspeed.sh</code>。</li>
</ul>
</li>
</ul>
<h4>第六阶段：收尾 (性能分析)</h4>
<blockquote>
<p>对应最后一步</p>
</blockquote>
<ul>
<li>[ ] <strong>Task 15: 性能分析工具测试</strong><ul>
<li><strong>目标</strong>：测试 NPU 的性能分析工具（Profiling）是否好用。</li>
<li><strong>动作</strong>：运行 <code>test_special_mstx_profile.py</code>。</li>
</ul>
</li>
</ul>
<hr />
<h3>总结：这个文件到底在讲啥？</h3>
<p><strong>核心观点：</strong>
这不仅仅是一个脚本，它是 <strong>Verl 框架在国产硬件（华为昇腾）上的“体检报告”生成器</strong>。</p>
<p>它通过列出一系列从简单（数据处理）到复杂（PPO、SFT、MoE、Megatron集成）的任务，<strong>一步步验证</strong>代码库在 NPU 环境下的兼容性。如果这个 List 里任何一个 Task 失败了（报错），GitHub 就会显示红色的 ❌，告诉开发者：“你的新代码把华为 NPU 的支持搞坏了，快去修！”</p>