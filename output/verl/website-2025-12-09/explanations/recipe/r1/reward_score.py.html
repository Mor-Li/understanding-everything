<h1>recipe/r1/reward_score.py</h1>
<p>没问题，这段代码对于初学者来说可能看起来有点抽象，但它的逻辑其实非常简单。</p>
<p>你可以把这段代码想象成一个<strong>“阅卷组长”</strong>。它的工作不是亲自去改每一张卷子，而是<strong>看一眼卷子是哪一科的，然后把它分发给对应的专业老师去改</strong>。</p>
<p>在 AI 训练中，我们需要给 AI 生成的答案打分（Reward），这段代码就是用来决定“该用什么标准来打分”的。</p>
<p>下面我列一个 <strong>Todo List（任务清单）</strong>，带你一步步看懂在这个“阅卷组长”的大脑里发生了什么：</p>
<hr />
<h3>📝 任务清单：阅卷组长的分发流程</h3>
<h4>✅ Task 1: 接收考生试卷（定义函数）</h4>
<p><strong>代码对应：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reward_func</span><span class="p">(</span><span class="n">data_source</span><span class="p">,</span> <span class="n">solution_str</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">extra_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</code></pre></div>

<p><strong>解读：</strong>
组长（函数 <code>reward_func</code>）坐在桌子前，接收了四个信息：
1.  <code>data_source</code>：<strong>这是哪门课的卷子？</strong>（比如是数学竞赛题，还是编程题？）
2.  <code>solution_str</code>：<strong>考生的答案是什么？</strong>（AI 生成的解题过程）
3.  <code>ground_truth</code>：<strong>标准答案是什么？</strong>（参考答案）
4.  <code>extra_info</code>：其他附加信息（暂时不太重要）。</p>
<hr />
<h4>✅ Task 2: 判断是不是“数学竞赛”题（分支一）</h4>
<p><strong>代码对应：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">if</span> <span class="n">data_source</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Maxwell-Jia/AIME_2024&quot;</span><span class="p">,</span> <span class="s2">&quot;opencompass/cnmo2024_en&quot;</span><span class="p">,</span> <span class="s2">&quot;opencompass/cnmo2024_zh&quot;</span><span class="p">]:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">recipe.r1.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">math_reward</span>
    <span class="k">return</span> <span class="n">math_reward</span><span class="o">.</span><span class="n">compute_score</span><span class="p">(</span><span class="n">solution_str</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">)</span>
</code></pre></div>

<p><strong>解读：</strong>
*   <strong>检查：</strong> 组长看了一眼标签，如果是 <code>AIME</code>（美国数学邀请赛）或者 <code>CNMO</code>（中国数学奥林匹克）。
*   <strong>动作：</strong> 既然是数学题，组长自己不改，他大喊一声：“把<strong>数学阅卷专家</strong>（<code>math_reward</code>）叫来！”
*   <strong>结果：</strong> 把考生的答案和标准答案扔给数学专家，让专家算出一个分数返回去。</p>
<hr />
<h4>✅ Task 3: 判断是不是“硬核科学问答”题（分支二）</h4>
<p><strong>代码对应：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">elif</span> <span class="n">data_source</span> <span class="o">==</span> <span class="s2">&quot;Idavidrein/gpqa&quot;</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">recipe.r1.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">gpqa</span>
    <span class="k">return</span> <span class="n">gpqa</span><span class="o">.</span><span class="n">compute_score</span><span class="p">(</span><span class="n">solution_str</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">)</span>
</code></pre></div>

<p><strong>解读：</strong>
*   <strong>检查：</strong> 如果标签是 <code>gpqa</code>（这是一个专门针对研究生水平的科学问答数据集）。
*   <strong>动作：</strong> 组长说：“这是高难度科学题，把<strong>GPQA专家</strong>（<code>gpqa</code>）叫来！”
*   <strong>结果：</strong> 让 GPQA 专家去打分。</p>
<hr />
<h4>✅ Task 4: 判断是不是“写代码”题（分支三）</h4>
<p><strong>代码对应：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">elif</span> <span class="n">data_source</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;livecodebench/code_generation_lite&quot;</span><span class="p">,</span> <span class="s2">&quot;livecodebench/code_generation&quot;</span><span class="p">]:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">recipe.r1.tasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">livecodebench</span>
    <span class="k">return</span> <span class="n">livecodebench</span><span class="o">.</span><span class="n">compute_score</span><span class="p">(</span><span class="n">solution_str</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">)</span>
</code></pre></div>

<p><strong>解读：</strong>
*   <strong>检查：</strong> 如果标签是 <code>livecodebench</code>（代码生成测试）。
*   <strong>动作：</strong> 组长说：“这是编程题，数学老师改不了，把<strong>程序员</strong>（<code>livecodebench</code>）叫来！”
*   <strong>结果：</strong> 让程序员运行一下代码，看看对不对，然后打分。</p>
<hr />
<h4>✅ Task 5: 遇到不认识的卷子怎么办？（异常处理）</h4>
<p><strong>代码对应：</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div>

<p><strong>解读：</strong>
*   <strong>检查：</strong> 如果手里拿到的卷子，既不是数学，也不是科学，也不是编程（比如是写诗或者翻译）。
*   <strong>动作：</strong> 组长懵了，因为上面并没有安排对应的阅卷老师。
*   <strong>结果：</strong> 组长直接掀桌子报错（<code>raise NotImplementedError</code>）：<strong>“这题没法改！我不知道该找谁！”</strong></p>
<hr />
<h3>总结</h3>
<p>这个文件的核心作用就是一个<strong>“路由器”</strong>或<strong>“分发器”</strong>。</p>
<ul>
<li><strong>输入：</strong> 题目来源、AI的回答、正确答案。</li>
<li><strong>过程：</strong> 根据题目来源（<code>data_source</code>），动态导入（<code>import</code>）不同的评分模块。</li>
<li><strong>输出：</strong> 最终的分数。</li>
</ul>
<p>这样写的好处是，以后如果想加一个“写作文”的评分标准，只需要再加一个 <code>elif</code>，不用改动其他逻辑。</p>