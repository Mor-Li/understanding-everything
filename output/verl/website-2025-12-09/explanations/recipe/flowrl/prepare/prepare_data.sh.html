<h1>recipe/flowrl/prepare/prepare_data.sh</h1>
<p>完全没问题。这段代码其实就像是一个<strong>“自动采购清单”</strong>。</p>
<p>想象一下，你要做一道菜（训练一个 AI 模型），你需要去超市（HuggingFace 网站）把原材料（数据）买回来，然后洗好切好放在盘子里（整理到指定文件夹）。</p>
<p>这段脚本主要就干了这一件事。</p>
<p>下面我为你列一个<strong>任务清单 (To-Do List)</strong>，然后一步步给你解释它是怎么做的。</p>
<h3>📋 任务清单 (To-Do List)</h3>
<p>这个脚本按顺序执行了以下 6 个任务：</p>
<ol>
<li><strong>准备环境</strong>：设定好“我们要把东西存在哪”，并创建好对应的文件夹。</li>
<li><strong>下载训练食材</strong>：去 HuggingFace 下载第一份数据（DAPO-Math-17k，用于训练）。</li>
<li><strong>整理训练食材</strong>：把下载下来的核心文件拿出来，放到最终的数据文件夹里。</li>
<li><strong>下载考试食材</strong>：去 HuggingFace 下载第二份数据（AIME-2024，用于测试/考试）。</li>
<li><strong>整理考试食材</strong>：同样把核心文件拿出来，放到最终的数据文件夹里。</li>
<li><strong>汇报结果</strong>：告诉用户“搞定了”，并打印出文件现在在哪里。</li>
</ol>
<hr />
<h3>🔍 逐步详解 (Step-by-Step)</h3>
<p>现在我们对应代码，一步一步看它是怎么完成上面这个清单的。</p>
<h4>第一步：准备环境 (设置路径)</h4>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DOWNLOAD_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="k">:-</span><span class="s2">&quot;downloads&quot;</span><span class="si">}</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DATA_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="k">:-</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">/data&quot;</span><span class="si">}</span>

<span class="c1"># Create final data directory</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：<ul>
<li>它定义了两个变量：<code>DOWNLOAD_DIR</code>（下载缓存目录）和 <code>DATA_DIR</code>（最终存放数据的目录）。</li>
<li><code>mkdir -p</code>：这行命令的意思是“创建一个文件夹”。如果文件夹不存在，就新建一个；如果已经存在，就什么都不做。</li>
<li><strong>人话</strong>：先腾出一块空地，准备放东西。</li>
</ul>
</li>
</ul>
<h4>第二步：下载训练数据 (DAPO-Math)</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">DATASET_NAME_TRAIN</span><span class="o">=</span><span class="s2">&quot;BytedTsinghua-SIA/DAPO-Math-17k&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Downloading </span><span class="si">${</span><span class="nv">DATASET_NAME_TRAIN</span><span class="si">}</span><span class="s2">...&quot;</span>
huggingface-cli<span class="w"> </span>download<span class="w"> </span><span class="nv">$DATASET_NAME_TRAIN</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--repo-type<span class="w"> </span>dataset<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resume-download<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--local-dir<span class="w"> </span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="si">}</span>/<span class="si">${</span><span class="nv">DATASET_NAME_TRAIN</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--local-dir-use-symlinks<span class="w"> </span>False
</code></pre></div>

<ul>
<li><strong>解释</strong>：<ul>
<li>它指定了要下载的数据集名字叫 <code>DAPO-Math-17k</code>（这是一个包含 1.7万道数学题的数据集）。</li>
<li><code>huggingface-cli download</code>：这是调用一个下载工具，去网上把这个数据包拉下来。</li>
<li><strong>人话</strong>：去网上的数据库里，把“数学题训练册”下载到本地的缓存文件夹里。</li>
</ul>
</li>
</ul>
<h4>第三步：整理训练数据 (移动文件)</h4>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DATASET_NAME_TRAIN</span><span class="si">}</span><span class="s2">/data/dapo-math-17k.parquet&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DATASET_NAME_TRAIN</span><span class="si">}</span><span class="s2">/data/dapo-math-17k.parquet&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/dapo-math-17k.parquet&quot;</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✓ Moved dapo-math-17k.parquet to </span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：<ul>
<li>下载下来的文件夹里可能有很多乱七八糟的东西。</li>
<li><code>mv</code> 命令：Move（移动）。</li>
<li><code>.parquet</code>：这是一种高效的数据存储格式（你可以把它理解为一种给电脑读的高级 Excel 表格）。</li>
<li><strong>人话</strong>：从刚才下载的一大堆文件里，把那个最重要的 <code>.parquet</code> 数据文件挑出来，移动到我们最开始建好的干净的 <code>data</code> 文件夹里。</li>
</ul>
</li>
</ul>
<h4>第四步：下载测试数据 (AIME)</h4>
<div class="codehilite"><pre><span></span><code><span class="nv">DATASET_NAME_TEST</span><span class="o">=</span><span class="s2">&quot;BytedTsinghua-SIA/AIME-2024&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Downloading </span><span class="si">${</span><span class="nv">DATASET_NAME_TEST</span><span class="si">}</span><span class="s2">...&quot;</span>
huggingface-cli<span class="w"> </span>download<span class="w"> </span><span class="nv">$DATASET_NAME_TEST</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>...<span class="w"> </span><span class="o">(</span>参数同上<span class="o">)</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：<ul>
<li>这次下载的是 <code>AIME-2024</code>。AIME 是美国数学邀请赛，这个数据集通常用来测试 AI 做数学题有多厉害。</li>
<li><strong>人话</strong>：去下载一套“2024年的数学考卷”，用来一会考考 AI。</li>
</ul>
</li>
</ul>
<h4>第五步：整理测试数据 (移动文件)</h4>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DATASET_NAME_TEST</span><span class="si">}</span><span class="s2">/data/aime-2024.parquet&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DOWNLOAD_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">DATASET_NAME_TEST</span><span class="si">}</span><span class="s2">/data/aime-2024.parquet&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/aime-2024.parquet&quot;</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;✓ Moved aime-2024.parquet to </span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/&quot;</span>
<span class="k">fi</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：<ul>
<li>和第三步一样，把下载下来的 AIME 数据文件移动到干净的文件夹里。</li>
<li><strong>人话</strong>：把考卷也整理好，和刚才的训练册放在一起。</li>
</ul>
</li>
</ul>
<h4>第六步：大功告成</h4>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Data preparation completed!&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Training file: </span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/dapo-math-17k.parquet&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Test file: </span><span class="si">${</span><span class="nv">DATA_DIR</span><span class="si">}</span><span class="s2">/aime-2024.parquet&quot;</span>
</code></pre></div>

<ul>
<li><strong>解释</strong>：<ul>
<li><code>echo</code> 就是在屏幕上打印字。</li>
<li><strong>人话</strong>：并在屏幕上告诉你：“数据准备好了！训练用的书在这里，考试用的卷子在那里。”</li>
</ul>
</li>
</ul>
<h3>💡 总结</h3>
<p>这个脚本没有进行任何复杂的计算，它只是一个<strong>搬运工</strong>：
它帮你把<strong>训练数据</strong>和<strong>测试数据</strong>从网上下载下来，并整整齐齐地放在 <code>downloads/data/</code> 文件夹里，方便后续的 AI 程序直接读取使用。</p>