<h1>recipe/open_math_reasoning/prepare_eval_dataset.py</h1>
<p>这份代码其实就是一个<strong>“数据搬运和清洗工”</strong>。</p>
<p>它的主要任务是：把原始的数学竞赛题（AIME 2024 和 2025），处理成 AI 模型训练或评测时能读懂的统一格式，最后存成文件。</p>
<p>为了让你更容易理解，我把它拆解成一个 <strong>Task To-Do List（任务清单）</strong>，咱们一步一步来看计算机是怎么执行这个“任务”的。</p>
<hr />
<h3>📋 任务清单：准备数学评测数据</h3>
<h4>Task 1：准备工具箱 (Imports &amp; Setup)</h4>
<p>在开始干活前，代码先拿出了需要的工具：
*   <strong><code>datasets</code></strong>: 这是一个专门用来下载和处理数据集的工具包（就像 Excel，但专门给代码用）。
*   <strong><code>remove_boxed</code></strong>:这是一个清洁工具，用来把数学答案里的格式清理干净（比如把 <code>\boxed{42}</code> 变成 <code>42</code>）。
*   <strong>设定口令 (<code>instruction_following</code>)</strong>:
    *   代码定义了一句话：<code>"Please reason step by step, and put your final answer within \\boxed{}."</code>
    *   <strong>目的</strong>：以后每一道题后面都要加上这句话，告诉 AI：“请一步步推理，并且把最终答案放在方框里”。</p>
<h4>Task 2：制定“加工流水线”规则 (Function: <code>make_map_fn</code>)</h4>
<p>这是代码里最核心的部分。它并没有马上执行，而是先写好了一张<strong>“操作说明书”</strong>。这张说明书告诉计算机：<strong>“给你一道原始题目，你该怎么把它改成我们想要的样子？”</strong></p>
<p>具体步骤如下：
1.  <strong>提取题目</strong>：把原始数据里的题目拿出来，跟上面的“口令”拼在一起，变成完整的 Prompt。
2.  <strong>提取答案</strong>：检查原始数据，有的叫 <code>solution</code>，有的叫 <code>answer</code>，反正把答案找出来。
3.  <strong>清洗答案</strong>：用 <code>remove_boxed</code> 工具，把答案里的装饰去掉，只留核心数值（作为标准答案，用来给 AI 打分）。
4.  <strong>填表（格式化）</strong>：把上面处理好的信息，填进一个新的表格（字典）里，包含：
    *   <code>prompt</code>: 发给 AI 的完整问题。
    *   <code>reward_model</code>: 告诉评测系统标准答案是什么。
    *   <code>data_source</code>: 标记这道题是 AIME24 还是 AIME25。</p>
<h4>Task 3：接收老板指令 (Argparse)</h4>
<p>程序开始运行（<code>if __name__ == "__main__":</code>），它先听用户的命令：
*   用户有没有指定<strong>原始数据在哪</strong>？(<code>--local_dataset_path</code>)
*   用户想把<strong>结果存哪</strong>？(<code>--local_save_dir</code>)
*   如果用户没说，就用默认路径。</p>
<h4>Task 4：进货 (Load Dataset)</h4>
<p>根据刚才确定的路径，程序去把两份原始试卷拿进来：
1.  <strong>AIME 2024 测试集</strong>
2.  <strong>AIME 2025 测试集</strong>
它使用 <code>datasets.load_dataset</code> 把这些数据加载到内存里。</p>
<h4>Task 5：开始批量加工 (Map)</h4>
<p>这是最忙碌的一步。程序调用 <code>.map()</code> 方法。
*   <strong>动作</strong>：它把 <strong>Task 2</strong> 里制定的“操作说明书”拿出来，对 <strong>Task 4</strong> 里进货的每一道题都执行一遍。
*   <strong>结果</strong>：原本乱七八糟的原始数据，现在全部变成了统一标准的格式。</p>
<h4>Task 6：打包入库 (Save)</h4>
<p>数据处理完了，最后一步是保存。
*   程序创建一个文件夹（如果不存在的话）。
*   把处理好的 AIME 24 数据存为 <code>aime24_test.parquet</code>。
*   把处理好的 AIME 25 数据存为 <code>aime25_test.parquet</code>。
*   <em>注：Parquet 是一种压缩效率很高的文件格式，类似高级版的 CSV。</em></p>
<hr />
<h3>总结一下</h3>
<p>这个脚本其实就干了三件事：
1.  <strong>读</strong>：读取原始的数学竞赛题。
2.  <strong>改</strong>：给题目加上“请一步步推理”的要求，把答案格式理顺，整理成统一的 JSON 结构。
3.  <strong>存</strong>：保存成文件，方便后续直接喂给 AI 模型去跑分（评测）。</p>