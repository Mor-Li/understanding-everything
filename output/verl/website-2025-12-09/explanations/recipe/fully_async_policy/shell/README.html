<h1>recipe/fully_async_policy/shell</h1>
<p>好的，我们把复杂的代码术语抛在脑后，用最轻松的方式来理解这个文件夹。</p>
<h3>1. 这个文件夹主要负责什么功能？</h3>
<p><strong>🏠 形象比喻：这是“全天候 AI 强化特训营”的【启动控制室】。</strong></p>
<ul>
<li><strong>核心功能</strong>：这里面存放的全是<strong>启动脚本</strong>（按钮）。每一个脚本按下去，都会启动一套庞大的计算流程，目的是训练 AI 模型（主要是 Qwen 系列）学会解决复杂的<strong>数学题</strong>或<strong>几何题</strong>。</li>
<li><strong>最大特色（Fully Async）</strong>：这个文件夹名字里的 <code>fully_async</code> 是核心。<ul>
<li><strong>传统训练</strong>像“上课”：学生做题 -&gt; 老师批改 -&gt; 老师讲课 -&gt; 学生再做题。（大家互相等，效率低）。</li>
<li><strong>这里的训练</strong>像“流水线工厂”：<strong>做题组</strong>拼命做题，<strong>阅卷组</strong>拼命改卷并更新教材。两组人<strong>互不等待，同时开工</strong>。</li>
</ul>
</li>
</ul>
<p>所以，这个文件夹里的脚本，就是用来指挥这个“互不等待的流水线”如何运转的。</p>
<hr />
<h3>2. 各个文件是干什么的？</h3>
<p>我们可以把这些脚本看作是不同规格的<strong>“特训套餐清单”</strong>：</p>
<h4>🥗 <strong>A 类：轻量级/标准套餐 (FSDP系列)</strong></h4>
<ul>
<li><strong>文件名特征</strong>：带有 <code>fsdp2</code>，<code>7b</code>。</li>
<li><strong>代表文件</strong>：<ul>
<li><code>dapo_7b_math_fsdp2_4_4.sh</code></li>
<li><code>dapo_7b_math_fsdp2_32_32.sh</code></li>
</ul>
</li>
<li><strong>作用</strong>：这是最常用的训练配方。使用 PyTorch 自带的 FSDP 技术（省显存），训练 7B 大小的模型。</li>
<li><strong>数字含义</strong>：<code>4_4</code> 或 <code>32_32</code> 代表显卡的分配。比如 <code>4_4</code> 意味着 4 张卡负责做题，4 张卡负责学习。</li>
</ul>
<h4>🍔 <strong>B 类：巨无霸套餐 (Megatron系列)</strong></h4>
<ul>
<li><strong>文件名特征</strong>：带有 <code>megatron</code>，<code>30b</code>。</li>
<li><strong>代表文件</strong>：<code>grpo_30b_a3b_base_math_megatron_96_32.sh</code></li>
<li><strong>作用</strong>：这是给超大模型（30B参数）准备的。因为模型太大，普通盘子装不下，必须用 <code>Megatron</code> 这种重型框架把模型切碎了训练。</li>
<li><strong>规模</strong>：动用了上百张显卡（96+32=128张），是真正的“大工程”。</li>
</ul>
<h4>🛠️ <strong>C 类：特殊技能套餐</strong></h4>
<ul>
<li><strong><code>dapo_7b_async_retool.sh</code></strong>：<strong>工具使用特训</strong>。不仅让 AI 算数，还允许它使用计算器或写代码（Retool）来解题。</li>
<li><strong><code>geo3k_qwen25vl_7b_megatron_4_4.sh</code></strong>：<strong>几何特训</strong>。训练的是 VL（视觉）模型，让 AI 能看懂几何图形并解题。</li>
</ul>
<h4>⚙️ <strong>D 类：环境配置文件</strong></h4>
<ul>
<li><strong><code>runtime_env.yaml</code></strong>：<strong>总开关设置</strong>。这不是脚本，而是一张便利贴。上面写着：“启动前请强制开启 vLLM V1 引擎，并把报错信息开到最大。”</li>
</ul>
<hr />
<h3>3. 给我一个高层认知（一图胜千言）</h3>
<p>要理解这部分代码，你只需要脑补一个 <strong>“回转寿司店”</strong> 的画面：</p>
<ol>
<li>
<p><strong>以前的训练（Sync）</strong>：</p>
<ul>
<li>厨师（训练GPU）握好一个寿司，放到传送带上。</li>
<li>客人（推理GPU）吃完，举手说“好/不好”。</li>
<li>厨师收到反馈，思考一下，再握下一个。</li>
<li><strong>缺点</strong>：厨师等客人吃，客人等厨师做，很慢。</li>
</ul>
</li>
<li>
<p><strong>现在的训练（Fully Async - 这个文件夹做的事）</strong>：</p>
<ul>
<li><strong>一堆客人（Rollout GPU）</strong>：不管厨师在干嘛，疯狂从传送带上拿寿司吃，边吃边往盘子里扔评分卡。</li>
<li><strong>一堆厨师（Train GPU）</strong>：不管客人在干嘛，疯狂从盘子里收评分卡，根据反馈改良菜谱，疯狂握新寿司扔上传送带。</li>
<li><strong>关键点</strong>：<strong>谁也不等谁！</strong> 虽然客人吃到的可能是“几秒钟前”的旧款寿司，但整个店铺的吞吐量（训练效率）翻了好几倍。</li>
</ul>
</li>
</ol>
<p><strong>总结：</strong>
这个文件夹就是用来<strong>配置和启动这家“疯狂回转寿司店”的说明书</strong>。它决定了雇多少个厨师、多少个客人、做什么口味的寿司（数学/几何）、以及由于大家互不等待，允许寿司在传送带上转多久（Staleness）。</p>