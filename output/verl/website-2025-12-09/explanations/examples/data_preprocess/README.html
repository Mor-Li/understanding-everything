<h1>examples/data_preprocess</h1>
<p>这个文件夹 <code>examples/data_preprocess</code> 是整个 AI 训练流程中的<strong>“中央厨房”</strong>（或者叫<strong>“净菜加工厂”</strong>）。</p>
<p>为了让你秒懂，我们用<strong>“做饭”</strong>来比喻<strong>“训练 AI”</strong>：</p>
<ul>
<li><strong>原始数据</strong>（HuggingFace 上的数据集） = <strong>刚从地里拔出来的带着泥巴的蔬菜、活鸡、整袋的大米</strong>。</li>
<li><strong>AI 模型</strong> = <strong>一位非常挑剔的食客</strong>（或者一个只认标准包装的自动炒菜机器人）。</li>
<li><strong>这个文件夹的作用</strong> = <strong>洗菜、切菜、搭配佐料、装盒</strong>。</li>
</ul>
<hr />
<h3>1. 这个文件夹主要负责什么功能？</h3>
<p>它的核心功能只有三个字：<strong>“标准化”</strong>。</p>
<p>原始数据千奇百怪，有的只有题目没有答案，有的答案写得很乱，有的格式是 CSV，有的是 JSON。
这个文件夹里的脚本，就是要把这些乱七八糟的原材料，统一加工成 <strong>Verl 训练框架</strong>（也就是你正在用的这个系统）能直接“吃”下去的 <strong>标准半成品（Parquet 格式）</strong>。</p>
<p>它做了三件最重要的小事：
1.  <strong>加人设（Prompting）</strong>：给题目加上“你是一个数学专家，请一步步思考”这样的指令。
2.  <strong>抠答案（Ground Truth）</strong>：把长篇大论的解题过程里的“最终数字”抠出来，方便后面电脑自动判卷。
3.  <strong>配工具（Tool Config）</strong>：如果是训练 AI 写代码或用计算器，它会把“工具包”和“验证标准”预先埋进数据里。</p>
<hr />
<h3>2. 各个文件是干什么的？</h3>
<p>这些文件虽然名字不同，但其实都是<strong>针对不同食材（数据集）的专用处理流水线</strong>。我们可以把它们分成几类：</p>
<h4>🥗 <strong>数学类流水线 (Math Chefs)</strong></h4>
<ul>
<li><strong><code>gsm8k.py</code> / <code>math_dataset.py</code> / <code>dapo...py</code> / <code>aime...py</code></strong>:<ul>
<li><strong>食材</strong>：各种难度的数学题（小学奥数、高中竞赛等）。</li>
<li><strong>加工方式</strong>：把题目变成对话格式，强制要求 AI 写出思维链（CoT），并提取出数字答案。</li>
</ul>
</li>
</ul>
<h4>📐 <strong>几何与视觉类流水线 (Geometry Chefs)</strong></h4>
<ul>
<li><strong><code>geo3k.py</code> / <code>geo3k_multiturn_w_tool.py</code></strong>:<ul>
<li><strong>食材</strong>：带图片的几何题。</li>
<li><strong>加工方式</strong>：除了处理文字，还要处理图片信息，让 AI 能“看图做题”。</li>
</ul>
</li>
</ul>
<h4>🛠️ <strong>带“工具”的高级流水线 (Tool-Use Specialists)</strong></h4>
<ul>
<li><strong>凡是带 <code>_w_tool</code> 或 <code>_tool_agent</code> 后缀的脚本</strong>（如 <code>gsm8k_multiturn_w_tool.py</code>）：<ul>
<li><strong>特殊加工</strong>：这些脚本不仅给题目，还会在数据里<strong>埋入“工具调用”的指令</strong>。</li>
<li><strong>目的</strong>：训练 AI 不要在脑子里硬算，而是学会写 Python 代码或者调用计算器来解题。它会把“标准答案”塞给工具环境，这样 AI 算出结果后，环境能立刻告诉它对不对。</li>
</ul>
</li>
</ul>
<h4>💬 <strong>通用对话与常识类 (General Chat Chefs)</strong></h4>
<ul>
<li><strong><code>hellaswag.py</code> / <code>pokemon.py</code> / <code>multiturn.py</code></strong>:<ul>
<li><strong>食材</strong>：常识选择题、宝可梦对话、或者是为了测试瞎编的对话。</li>
<li><strong>加工方式</strong>：处理成标准的多轮对话格式（User 问，Assistant 答）。</li>
</ul>
</li>
</ul>
<h4>🔍 <strong>搜索类 (Search Chefs)</strong></h4>
<ul>
<li><strong><code>preprocess_search_r1_dataset.py</code></strong>:<ul>
<li><strong>加工方式</strong>：把数据改造成“先思考、再搜索、最后回答”的格式，训练类似 DeepSeek-R1 这种能联网思考的模型。</li>
</ul>
</li>
</ul>
<hr />
<h3>3. 高层认知：如何快速理解这部分代码？</h3>
<p>以后你看到这个文件夹里的任何一个文件，脑子里只需要装下这个 <strong>“三步走公式”</strong>，就能看穿一切：</p>
<ul>
<li>
<p><strong>Step 1: 进货 (Load)</strong></p>
<ul>
<li>代码开头一定是在用 <code>datasets.load_dataset(...)</code>。</li>
<li><em>潜台词：</em> “去把那堆原始数据给我拉过来。”</li>
</ul>
</li>
<li>
<p><strong>Step 2: 改装 (Transform - 核心)</strong></p>
<ul>
<li>代码中间一定有个 <code>make_map_fn</code> 或者 <code>process_fn</code> 函数。</li>
<li><em>潜台词：</em> “把每一条数据拿出来，把‘问题’包装成‘用户指令’，把‘答案’里的数字抠出来做成‘判卷标准’，如果有工具就把‘工具配置’塞进去。”</li>
</ul>
</li>
<li>
<p><strong>Step 3: 发货 (Save)</strong></p>
<ul>
<li>代码结尾一定是 <code>.to_parquet(...)</code>。</li>
<li><em>潜台词：</em> “把处理好的净菜打包压缩，存到硬盘上，准备喂给显卡去训练。”</li>
</ul>
</li>
</ul>
<p><strong>一句话总结：</strong>
<strong>这就是给 AI 准备“营养午餐”的地方，把五花八门的网上数据，变成整整齐齐、带标准答案、方便机器消化的训练数据包。</strong></p>