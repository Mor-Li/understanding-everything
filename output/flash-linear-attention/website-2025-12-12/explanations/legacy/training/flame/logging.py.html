<h1>legacy/training/flame/logging.py</h1>
<p>æ²¡é—®é¢˜ï¼Œè¿™æ®µä»£ç ç¡®å®æ¶‰åŠåˆ°äº†<strong>åˆ†å¸ƒå¼è®­ç»ƒ</strong>ã€<strong>HuggingFace Transformers æ¡†æ¶</strong>ä»¥åŠ<strong>æ—¥å¿—ç®¡ç†</strong>ï¼Œå¦‚æœå¯¹è¿™äº›èƒŒæ™¯ä¸ç†Ÿæ‚‰ï¼Œçœ‹ä»£ç ä¼šè§‰å¾—å¾ˆä¹±ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯<strong>ç»™è®­ç»ƒè¿‡ç¨‹åšä¸€ä¸ªâ€œç§äººå®šåˆ¶â€çš„è®°å½•å‘˜</strong>ã€‚å®ƒä¸æ»¡è¶³äºç³»ç»Ÿé»˜è®¤çš„æ‰“å°æ–¹å¼ï¼Œè€Œæ˜¯æƒ³æŠŠè®­ç»ƒçš„è¿›åº¦ã€Lossï¼ˆè¯¯å·®ï¼‰ã€é€Ÿåº¦ç­‰ä¿¡æ¯ï¼ŒæŒ‰ç…§ç‰¹å®šçš„æ ¼å¼å†™åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼ˆ<code>trainer_log.jsonl</code>ï¼‰ï¼Œæ–¹ä¾¿åç»­ç”»å›¾æˆ–è€…ç›‘æ§ã€‚</p>
<p>ä¸ºäº†è®©ä½ å¬æ‡‚ï¼Œæˆ‘æŠŠè¿™ä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ‹†è§£æˆä¸€ä¸ª <strong>â€œè®­ç»ƒè®°å½•å‘˜çš„å¾…åŠæ¸…å• (Todo List)â€</strong>ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥æ¥çœ‹å®ƒæ˜¯æ€ä¹ˆå®Œæˆè¿™äº›ä»»åŠ¡çš„ã€‚</p>
<hr />
<h3>ğŸ“‹ è®­ç»ƒè®°å½•å‘˜çš„ Todo List</h3>
<ol>
<li><strong>å‡†å¤‡å·¥å…·ï¼ˆSetupï¼‰</strong>ï¼šè®¾ç½®å¥½å–‡å­ï¼ˆLoggerï¼‰ï¼Œå†³å®šåªæœ‰ç»„é•¿ï¼ˆä¸»è¿›ç¨‹ï¼‰èƒ½è¯´è¯ï¼Œé¿å…å¤ªåµã€‚</li>
<li><strong>å…¥èŒæŠ¥åˆ°ï¼ˆInitï¼‰</strong>ï¼šå¸¦ä¸Šç§’è¡¨ï¼Œå‡†å¤‡å¼€å§‹è®¡æ—¶ã€‚</li>
<li><strong>å¼€å·¥ä»ªå¼ï¼ˆOn Train Beginï¼‰</strong>ï¼š<ul>
<li>å¦‚æœæ˜¯ä»å¤´å¼€å§‹ï¼Œå°±æŠŠç§’è¡¨å½’é›¶ï¼Œæ’•æ‰æ—§çš„æ—¥å¿—æœ¬ã€‚</li>
<li>å¦‚æœæ˜¯â€œæ–­ç‚¹ç»­ä¼ â€ï¼ˆæ¥ç€ä¸Šæ¬¡ç»ƒï¼‰ï¼Œå°±æŠŠç§’è¡¨è°ƒå›åˆ°ä¸Šæ¬¡çš„æ—¶é—´ã€‚</li>
</ul>
</li>
<li><strong>æ—¥å¸¸è®°å½•ï¼ˆOn Logï¼‰</strong>ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆæ¯”å¦‚æ¯10æ­¥ï¼‰ï¼š<ul>
<li>çœ‹ä¸€çœ¼ç§’è¡¨ï¼Œç®—ç®—è¿‡äº†å¤šä¹…ã€‚</li>
<li>ç®—ç®—å¤„ç†æ•°æ®çš„é€Ÿåº¦ï¼ˆThroughputï¼‰ã€‚</li>
<li>æŠŠå…³é”®ä¿¡æ¯ï¼ˆè¿›åº¦ã€Lossã€å­¦ä¹ ç‡ï¼‰å†™è¿› <code>trainer_log.jsonl</code> æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><strong>ä¿å­˜è®°å¿†ï¼ˆStateï¼‰</strong>ï¼šå¦‚æœè®­ç»ƒæš‚åœï¼Œè¦æŠŠç§’è¡¨çš„æ—¶é—´è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡æ¥ç€ç”¨ã€‚</li>
</ol>
<hr />
<h3>é€æ­¥è®²è§£ï¼ˆä¸­æ–‡å¤§ç™½è¯ç‰ˆï¼‰</h3>
<h4>1. å‡†å¤‡å·¥å…·ï¼šè®¾ç½®å–‡å­ (<code>get_logger</code>)</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_logger</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
    <span class="c1"># ... (çœç•¥ä¸­é—´æ ¼å¼è®¾ç½®)</span>
    <span class="k">if</span> <span class="s1">&#39;RANK&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;RANK&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div>

<ul>
<li><strong>è§‚ç‚¹</strong>ï¼šåœ¨å¤§è§„æ¨¡AIè®­ç»ƒä¸­ï¼Œé€šå¸¸ä¼šæœ‰å¾ˆå¤šå¼ æ˜¾å¡ï¼ˆGPUï¼‰ä¸€èµ·å·¥ä½œã€‚å¦‚æœæ¯å¼ å¡éƒ½å¾€å±å¹•ä¸Šæ‰“å°æ—¥å¿—ï¼Œå±å¹•å°±çˆ†ç‚¸äº†ã€‚</li>
<li><strong>ä»£ç é€»è¾‘</strong>ï¼šè¿™é‡Œæ£€æŸ¥ <code>RANK</code>ï¼ˆæ˜¾å¡çš„ç¼–å·ï¼‰ã€‚åªæœ‰ç¼–å·ä¸º <code>0</code> çš„æ˜¾å¡ï¼ˆç»„é•¿ï¼‰æ‰æœ‰èµ„æ ¼æ‰“å°æ—¥å¿—ï¼ˆ<code>logger.addHandler</code>ï¼‰ï¼Œå…¶ä»–çš„æ˜¾å¡éƒ½é—­å˜´ã€‚</li>
</ul>
<h4>2. å®šä¹‰è®°å½•å‘˜ï¼šæ’ä»¶æœºåˆ¶ (<code>class LogCallback</code>)</h4>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LogCallback</span><span class="p">(</span><span class="n">TrainerCallback</span><span class="p">,</span> <span class="n">ExportableState</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">elapsed_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">elapsed_time</span>
        <span class="c1"># ...</span>
</code></pre></div>

<ul>
<li><strong>è§‚ç‚¹</strong>ï¼šè¿™æ˜¯åˆ©ç”¨äº† HuggingFace çš„ <strong>Callbackï¼ˆå›è°ƒï¼‰</strong> æœºåˆ¶ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªâ€œæ’ä»¶â€ã€‚</li>
<li><strong>ä»£ç é€»è¾‘</strong>ï¼š<ul>
<li><code>TrainerCallback</code>ï¼šè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¢«è‡ªåŠ¨è°ƒç”¨çš„æ’ä»¶ã€‚</li>
<li><code>ExportableState</code>ï¼šè¯´æ˜è¿™ä¸ªæ’ä»¶çš„çŠ¶æ€æ˜¯å¯ä»¥è¢«ä¿å­˜ï¼ˆSaveï¼‰å’ŒåŠ è½½ï¼ˆLoadï¼‰çš„ã€‚</li>
<li><code>__init__</code>ï¼šåˆå§‹åŒ–ä¸¤ä¸ªè®¡æ—¶å™¨ï¼Œä¸€ä¸ªè®°å½•â€œå¼€å§‹æ—¶é—´â€ï¼Œä¸€ä¸ªè®°å½•â€œå·²ç»èŠ±è´¹çš„æ€»æ—¶é—´â€ã€‚</li>
</ul>
</li>
</ul>
<h4>3. å¼€å·¥ä»ªå¼ï¼šè®­ç»ƒå¼€å§‹æ—¶ (<code>on_train_begin</code>)</h4>
<div class="codehilite"><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># 1. æ£€æŸ¥æ˜¯ä¸æ˜¯åªæœ‰ä¸»è¿›ç¨‹åœ¨è¿è¡Œï¼ˆé¿å…å¤šå¡é‡å¤æ“ä½œï¼‰</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">save_on_each_node</span><span class="p">:</span> <span class="o">...</span> 

        <span class="c1"># 2. å¤„ç†æ–­ç‚¹ç»­ä¼  (Resume)</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">is_local_process_zero</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">resume_from_checkpoint</span><span class="p">:</span>
                <span class="c1"># å¦‚æœæ˜¯æ–°è®­ç»ƒï¼Œæ—¶é—´å½’é›¶</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># å¦‚æœæ˜¯æ¥ç€ä¸Šæ¬¡ç»ƒï¼Œä»å­˜æ¡£é‡Œæ¢å¤æ—¶é—´</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">stateful_callbacks</span><span class="p">[</span><span class="s1">&#39;LogCallback&#39;</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">stateful_callbacks</span><span class="p">[</span><span class="s1">&#39;LogCallback&#39;</span><span class="p">][</span><span class="s1">&#39;elapsed_time&#39;</span><span class="p">]</span>

        <span class="c1"># 3. æ¸…ç†æ—§æ—¥å¿—</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">overwrite_output_dir</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># åˆ æ‰æ—§çš„ trainer_log.jsonl</span>
</code></pre></div>

<ul>
<li><strong>è§‚ç‚¹</strong>ï¼šè®­ç»ƒå¼€å§‹çš„ä¸€ç¬é—´ï¼Œå¿…é¡»ææ¸…æ¥šæ˜¯â€œå…¨æ–°å¼€å§‹â€è¿˜æ˜¯â€œæ—§æ¢¦é‡æ¸©â€ã€‚</li>
<li><strong>ä»£ç é€»è¾‘</strong>ï¼š<ul>
<li>å¦‚æœæ˜¯ <code>resume_from_checkpoint</code>ï¼ˆç»­ä¼ ï¼‰ï¼Œå®ƒä¼šå»è¯»å–ä¹‹å‰çš„å­˜æ¡£ï¼ŒæŠŠç§’è¡¨è°ƒå¥½ï¼Œä¿è¯è®¡ç®—çš„æ—¶é—´æ˜¯ç´¯ç§¯çš„ã€‚</li>
<li>å¦‚æœæ˜¯æ–°è®­ç»ƒï¼Œä¸”å…è®¸è¦†ç›–ï¼ˆ<code>overwrite_output_dir</code>ï¼‰ï¼Œå®ƒä¼šæŠŠæ—§çš„æ—¥å¿—æ–‡ä»¶åˆ æ‰ï¼Œé˜²æ­¢æ•°æ®æ··åœ¨ä¸€èµ·ã€‚</li>
</ul>
</li>
</ul>
<h4>4. æ—¥å¸¸è®°å½•ï¼šæ¯éš”å‡ æ­¥è®°ä¸€æ¬¡ (<code>on_log</code>)</h4>
<p>è¿™æ˜¯æ•´ä¸ªæ–‡ä»¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚</p>
<div class="codehilite"><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">on_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="n">logs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># ... (çœç•¥è¿›ç¨‹æ£€æŸ¥)</span>

        <span class="c1"># 1. æ›´æ–°æ—¶é—´</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># 2. è®¡ç®—ååé‡ (Throughput) - ä¹Ÿå°±æ˜¯ç®—ç®—ç»ƒå¾—æœ‰å¤šå¿«</span>
        <span class="k">if</span> <span class="s1">&#39;num_input_tokens_seen&#39;</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
            <span class="n">logs</span><span class="p">[</span><span class="s1">&#39;num_tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;num_input_tokens_seen&#39;</span><span class="p">)</span>
            <span class="c1"># ååé‡ = å¤„ç†çš„æ€»Tokenæ•° / æ˜¾å¡æ•°é‡ / èŠ±è´¹æ—¶é—´</span>
            <span class="n">throughput</span> <span class="o">=</span> <span class="n">logs</span><span class="p">[</span><span class="s1">&#39;num_tokens&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">args</span><span class="o">.</span><span class="n">world_size</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span>
            <span class="n">state</span><span class="o">.</span><span class="n">log_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;throughput&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logs</span><span class="p">[</span><span class="s1">&#39;throughput&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">throughput</span>

        <span class="c1"># 3. æ•´ç†è¦å†™å…¥æ–‡ä»¶çš„æ•°æ®</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">current_steps</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">global_step</span><span class="p">,</span>  <span class="c1"># å½“å‰èµ°äº†å¤šå°‘æ­¥</span>
            <span class="n">total_steps</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">max_steps</span><span class="p">,</span>      <span class="c1"># æ€»å…±è¦èµ°å¤šå°‘æ­¥</span>
            <span class="n">loss</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">log_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="c1"># å½“å‰çš„è¯¯å·®</span>
            <span class="n">percentage</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">global_step</span> <span class="o">/</span> <span class="n">state</span><span class="o">.</span><span class="n">max_steps</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># ç™¾åˆ†æ¯”è¿›åº¦</span>
            <span class="c1"># ... å…¶ä»–å‚æ•°å¦‚å­¦ä¹ ç‡ã€epochç­‰</span>
        <span class="p">)</span>

        <span class="c1"># 4. å†™å…¥æ–‡ä»¶</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;trainer_log.jsonl&quot;</span><span class="p">),</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><strong>è§‚ç‚¹</strong>ï¼šç³»ç»Ÿè‡ªå¸¦çš„æ—¥å¿—å¤ªæ‚ä¹±ï¼Œæˆ‘æƒ³æŠŠæœ€é‡è¦çš„æ•°æ®ï¼ˆè¿›åº¦ã€Lossã€é€Ÿåº¦ï¼‰æ‘˜å‡ºæ¥ï¼Œå­˜æˆä¸€è¡Œè¡Œçš„ JSON æ•°æ®ï¼ˆJSONLæ ¼å¼ï¼‰ï¼Œæ–¹ä¾¿ç¨‹åºè¯»å–ã€‚</li>
<li><strong>ä»£ç é€»è¾‘</strong>ï¼š<ul>
<li>å®ƒè®¡ç®—äº† <code>throughput</code>ï¼ˆååé‡ï¼‰ï¼Œè¿™æ˜¯è¡¡é‡è®­ç»ƒæ•ˆç‡çš„é‡è¦æŒ‡æ ‡ã€‚</li>
<li>å®ƒæ„å»ºäº†ä¸€ä¸ªå¹²å‡€çš„å­—å…¸ <code>logs</code>ï¼ŒåªåŒ…å«æœ€é‡è¦çš„ä¿¡æ¯ã€‚</li>
<li>æœ€åç”¨ <code>"a"</code> (append) æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼ŒæŠŠè¿™ä¸€è¡Œæ•°æ®è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚</li>
</ul>
</li>
</ul>
<h4>5. ä¿å­˜è®°å¿†ï¼šå­˜æ¡£æœºåˆ¶ (<code>state</code> å’Œ <code>from_state</code>)</h4>
<div class="codehilite"><pre><span></span><code>    <span class="k">def</span><span class="w"> </span><span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
            <span class="s1">&#39;elapsed_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_state</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;elapsed_time&#39;</span><span class="p">])</span>
</code></pre></div>

<ul>
<li><strong>è§‚ç‚¹</strong>ï¼šå¦‚æœè®­ç»ƒäº†ä¸‰å¤©ä¸‰å¤œçªç„¶æ–­ç”µäº†ï¼Œä¸‹æ¬¡æ¢å¤æ—¶ï¼Œä¸ä»…æ¨¡å‹å‚æ•°è¦æ¢å¤ï¼Œ<strong>â€œæˆ‘ç»ƒäº†å¤šä¹…â€</strong> è¿™ä¸ªè®¡æ—¶å™¨çŠ¶æ€ä¹Ÿè¦æ¢å¤ã€‚</li>
<li><strong>ä»£ç é€»è¾‘</strong>ï¼š<ul>
<li><code>state()</code>ï¼šå½“ Trainer ä¿å­˜ Checkpoint æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ŒæŠŠå½“å‰çš„æ—¶é—´çŠ¶æ€æ‰“åŒ…å­˜èµ·æ¥ã€‚</li>
<li><code>from_state()</code>ï¼šå½“ Trainer åŠ è½½ Checkpoint æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼ŒæŠŠæ—¶é—´çŠ¶æ€æ¢å¤å›æ¥ã€‚</li>
</ul>
</li>
</ul>
<hr />
<h3>æ€»ç»“</h3>
<p>è¿™ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª<strong>è‡ªå®šä¹‰çš„è®­ç»ƒç›‘æ§æ’ä»¶</strong>ã€‚</p>
<ul>
<li><strong>å®ƒä¸åšæ•°å­¦è¿ç®—</strong>ï¼ˆä¸æ¶‰åŠæ¨¡å‹çš„å‰å‘åå‘ä¼ æ’­ï¼‰ã€‚</li>
<li><strong>å®ƒåªè´Ÿè´£è®°è´¦</strong>ï¼šç¡®ä¿åœ¨å•å¡æˆ–å¤šå¡ç¯å¢ƒä¸‹ï¼Œæ­£ç¡®åœ°è®°å½•è®­ç»ƒæ—¶é—´ã€è®¡ç®—è®­ç»ƒé€Ÿåº¦ï¼Œå¹¶æŠŠå¹²å‡€ã€æ ‡å‡†åŒ–çš„æ—¥å¿—æ•°æ®å†™å…¥ <code>trainer_log.jsonl</code> æ–‡ä»¶ä¸­ï¼Œä¾›åç»­åˆ†æä½¿ç”¨ã€‚</li>
</ul>